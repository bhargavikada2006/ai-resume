<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>AI Resume Analyzer & Job Matcher</title>

<style>
*{ box-sizing:border-box; }
body{margin:0;font-family:"Segoe UI",Arial;background:#0f172a;color:white}
header{background:#0f172a;color:white;padding:18px 60px;display:flex;justify-content:space-between;align-items:center}
.logo{font-size:22px;font-weight:bold;color:#22d3ee} nav a{color:#cbd5f5;margin:0 12px;text-decoration:none;font-size:14px;cursor:pointer}
.header-btns button{padding:8px 14px;border-radius:20px;border:none;cursor:pointer;margin-left:8px}
.login-btn{background:#1e293b;color:white} .free-btn{background:#22d3ee;color:#0f172a;font-weight:bold}
.container{max-width:1150px;margin:20px auto;padding:20px} .hidden{display:none}
.hero{display:flex;flex-direction:column;align-items:center;text-align:center;padding:40px 0;gap:20px} .hero p{max-width:550px;color:#cbd5f5}
.hero-img{background:#020617;border-radius:16px;padding:20px;box-shadow:0 0 40px rgba(34,211,238,.2)}
.hero-title{font-size:24px;font-weight:bold;color:#22d3ee;margin-bottom:10px}
.hero-img input[type="file"]{width:100%;padding:10px;border-radius:8px;margin-bottom:12px;background:#1e293b;color:white;border:none}
.hero-img img{width:100%;margin-top:12px;border-radius:10px;display:none} .uploaded-file{margin-top:12px;color:#22d3ee;font-weight:bold}
.card{background:#1e293b;color:white;padding:20px;margin-bottom:20px;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,0.2)}
.card input,.card select{width:100%;padding:12px;margin-bottom:12px;border-radius:8px;border:none;background:#0f172a;color:white}
.card button{padding:10px 16px;background:#22d3ee;color:#0f172a;border:none;border-radius:8px;cursor:pointer;margin-top:8px}
.progress{background:#1e293b;border-radius:20px;margin-bottom:10px} .bar{height:26px;border-radius:20px;color:white;text-align:center;font-weight:bold;line-height:26px}
.tabs{text-align:center;margin-bottom:15px} .tabs button{background:#0f172a;color:#22d3ee;margin:2px;padding:8px 12px;border:none;border-radius:6px;cursor:pointer}
.flowchart{display:flex;flex-direction:column;align-items:center}
.flow-box{background:#020617;padding:12px 20px;border-radius:8px;margin:8px 0;width:320px;font-weight:bold;border-left:6px solid #22d3ee;text-align:center}
.arrow{font-size:24px;color:#22d3ee} canvas{display:block;margin:auto}
.chatbot{background:#020617;border-radius:16px;padding:20px;max-width:700px;margin:auto}
.chat-header{text-align:center;font-size:20px;color:#22d3ee;margin-bottom:10px}
.chat-box{height:300px;overflow-y:auto;background:#0f172a;padding:15px;border-radius:12px}
.msg{margin:8px 0;padding:10px 14px;border-radius:12px;max-width:80%} .bot{background:#1e293b} .user{background:#22d3ee;color:#0f172a;margin-left:auto}
.topic-btns button{margin:6px;padding:8px 14px;border:none;border-radius:20px;background:#1e293b;color:white;cursor:pointer}
.mic-btn{margin-top:10px;padding:10px 16px;border-radius:50%;background:#22d3ee;border:none;font-size:18px;cursor:pointer}
.timer{text-align:center;margin-top:10px;font-weight:bold;color:#22d3ee;font-size:18px}
.profile-container{position:relative;display:none} .profile-icon{width:40px;height:40px;background:#22d3ee;border-radius:50%;display:flex;justify-content:center;align-items:center;font-weight:bold;color:#0f172a;cursor:pointer}
.profile-menu{position:absolute;top:50px;right:0;background:#1e293b;border-radius:8px;padding:10px;box-shadow:0 5px 15px rgba(0,0,0,0.3);display:none;flex-direction:column;width:150px;z-index:100}
.profile-menu button{background:none;border:none;color:white;padding:8px;text-align:left;cursor:pointer;width:100%;border-radius:4px;margin:2px 0} .profile-menu button:hover{background:#334155}
.menu-container{position:relative;display:inline-block;margin-left:10px} .menu-btn{background:none;border:none;color:#22d3ee;font-size:24px;cursor:pointer;padding:5px;vertical-align:middle}
.main-menu{position:absolute;top:45px;right:0;background:#1e293b;border-radius:8px;padding:10px;box-shadow:0 5px 15px rgba(0,0,0,0.3);display:none;flex-direction:column;width:240px;z-index:100;border:1px solid #334155}
.main-menu button{background:none;border:none;color:white;padding:10px;text-align:left;cursor:pointer;width:100%;border-radius:4px;margin:2px 0;font-size:14px} .main-menu button:hover{background:#334155;color:#22d3ee}
.comp-table td,.comp-table th{border:1px solid #334155;padding:10px}
.landing-hero{text-align:center;padding:80px 20px} .landing-title{font-size:48px;font-weight:bold;background:linear-gradient(90deg,#22d3ee,#3b82f6);-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:20px}
.landing-subtitle{font-size:18px;color:#cbd5f5;max-width:700px;margin:0 auto 30px auto;line-height:1.6}
.cta-group{display:flex;gap:20px;justify-content:center;margin-bottom:60px} .cta-btn{padding:15px 30px;border-radius:30px;font-size:16px;font-weight:bold;cursor:pointer;border:none;transition:transform 0.2s}
.cta-primary{background:#22d3ee;color:#0f172a} .cta-secondary{background:transparent;border:2px solid #22d3ee;color:#22d3ee} .cta-btn:hover{transform:scale(1.05)}
.section-title{text-align:center;font-size:32px;color:white;margin-bottom:40px;margin-top:60px}
.problem-box{background:#1e293b;padding:40px;border-radius:16px;text-align:center;border:1px solid #f87171;max-width:800px;margin:0 auto}
.features-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:30px}
.feature-card{background:#1e293b;padding:30px;border-radius:12px;border:1px solid #334155;transition:0.3s} .feature-card:hover{border-color:#22d3ee;transform:translateY(-5px)}
.feature-icon{font-size:32px;margin-bottom:15px;display:block}
.steps-container{display:flex;justify-content:space-between;gap:20px;flex-wrap:wrap}
.step-card{flex:1;min-width:200px;background:#020617;padding:20px;border-radius:12px;text-align:center;position:relative;border:1px solid #334155}
.step-num{background:#22d3ee;color:#0f172a;width:30px;height:30px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:bold;margin:0 auto 15px auto}
.upload-zone:hover{border-color:#22d3ee!important;background:#0f172a!important}
.comm-layout{display:flex;gap:40px;align-items:center;justify-content:center}
.comm-image{flex:1;display:flex;justify-content:center}
.comm-image img{width:100%;max-width:500px;border-radius:16px;box-shadow:0 0 30px rgba(34,211,238,0.15);border:1px solid #334155}
.comm-chat-wrapper{flex:1;width:100%}
@media(max-width:900px){.comm-layout{flex-direction:column}.comm-image img{max-width:100%}}

@keyframes float { 0% { transform: translateY(0px); } 50% { transform: translateY(-10px); } 100% { transform: translateY(0px); } }
.word-tag { background: rgba(34,211,238,0.2); color:#22d3ee; padding:4px 8px; border-radius:12px; font-size:12px; animation: popIn 0.3s ease; margin:2px; }
@keyframes popIn { from { transform: scale(0); } to { transform: scale(1); } }

/* NEW: Live Interview Feedback Styles */
.live-feedback {
  background: rgba(15, 23, 42, 0.95);
  border: 1px solid #22d3ee;
  border-radius: 8px;
  padding: 12px;
  margin-top: 10px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  animation: slideUp 0.3s ease;
}
.live-tag {
  background: rgba(34, 211, 238, 0.15);
  color: #22d3ee;
  padding: 4px 10px;
  border-radius: 15px;
  font-size: 12px;
  font-weight: bold;
  border: 1px solid rgba(34, 211, 238, 0.3);
}
@keyframes slideUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
.glow-green {
  box-shadow: 0 0 15px 4px rgba(74, 222, 128, 0.5);
  border-color: rgba(74, 222, 128, 0.7) !important;
}
.glow-yellow {
  box-shadow: 0 0 15px 4px rgba(250, 204, 21, 0.5);
  border-color: rgba(250, 204, 21, 0.7) !important;
}
.glow-red {
  box-shadow: 0 0 15px 4px rgba(248, 113, 113, 0.5);
  border-color: rgba(248, 113, 113, 0.7) !important;
}
.micro-tip {
  position: absolute;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(0, 0, 0, 0.75);
  color: white;
  padding: 8px 15px;
  border-radius: 20px;
  font-size: 14px;
  border: 1px solid rgba(255, 255, 255, 0.2);
  white-space: nowrap;
  pointer-events: none;
  animation: fadeInOutUp 4s ease-in-out forwards;
  z-index: 10;
}
@keyframes fadeInOutUp { 0% { opacity: 0; transform: translate(-50%, 20px); } 20% { opacity: 1; transform: translate(-50%, 0); } 80% { opacity: 1; transform: translate(-50%, 0); } 100% { opacity: 0; transform: translate(-50%, -20px); } }
@keyframes wave {
  0%, 100% { height: 20px; }
  50% { height: 50px; }
}
</style>
</head>

<body>

<!-- HEADER -->
<header>
  <div class="logo">AI Resume Analyzer & Job Matcher</div>
  <nav>
    <a onclick="showHome()">Home</a>
    <a onclick="showPanel('analyze')">Analyze Resume</a>
    <a onclick="showPanel('communication')">Communication Check</a>
    <a onclick="showPanel('interview')">Interview Preparation Support</a>
    <a onclick="showPanel('certificate')">Certificate Scanner</a>
    <a onclick="showPanel('templates')">Resume Templates</a>
  </nav>
  <div class="header-btns" id="authBtns">
    <button class="login-btn" id="loginBtn" onclick="showLogin()">Login</button>
    <div class="menu-container">
      <button class="menu-btn" onclick="toggleMainMenu()">‚ò∞</button>
      <div class="main-menu" id="mainMenu">
        <button onclick="showPanel('videoSim')">üìπ Video Interview Simulator</button>
        <button onclick="showPanel('coverLetter')">‚úâÔ∏è AI Cover Letter Generator</button>
        <button onclick="showPanel('salary')">üí∞ Salary Estimation AI</button>
        <button onclick="showPanel('discovery')">üåç Location-Based Jobs</button>
        <button onclick="showPanel('history')">üìà Resume History & Analysis</button>
        <button onclick="showPanel('games')">üéÆ Career Prep Games</button>
      </div>
    </div>
  </div>
  <div class="profile-container" id="profileSection">
    <div class="profile-icon" id="profileIcon" onclick="toggleProfileMenu()"></div>
    <div class="profile-menu" id="profileMenu">
      <button onclick="showPanel('profile')">Update Profile</button>
      <button onclick="showPanel('history')">üìú Activity History</button>
      <button onclick="logout()">Logout</button>
    </div>
  </div>
</header>

<div class="container">

<!-- HOME PAGE LANDING -->
<div id="homePage">
  <!-- Hero -->
  <div class="landing-hero">
    <h1 class="landing-title">Launch Your Career with AI Precision</h1>
    <p class="landing-subtitle">Stop guessing and start getting hired. Our AI-powered platform optimizes your resume, matches you with the right jobs, and prepares you for interviews.</p>
    <div class="cta-group">
      <button class="cta-btn cta-primary" onclick="showPanel('analyze')">Analyze Resume</button>
      <input type="file" id="resumeInput" accept=".doc,.docx,.pdf,.txt" style="display:none;" onchange="uploadResume(this)">
      <button class="cta-btn cta-secondary" onclick="showPanel('templates')">Explore Templates</button>
    </div>
  </div>

  <!-- Problem -->
  <div class="problem-box">
    <h3 style="color:#f87171; margin-top:0;">Why Resumes Fail?</h3>
    <p style="color:#cbd5f5; font-size:18px;">75% of resumes are rejected by ATS bots before a human ever sees them.</p>
    <p style="color:#94a3b8; font-size:14px;">Formatting errors, missing keywords, and poor structure are the silent killers of job applications.</p>
  </div>

  <!-- Features -->
  <h2 class="section-title">Everything You Need to Get Hired</h2>
  <div class="features-grid">
    <div class="feature-card">
      <span class="feature-icon">üìÑ</span>
      <h4>ATS Resume Scoring</h4>
      <p style="color:#94a3b8; font-size:14px;">Get a detailed score and fix formatting issues instantly.</p>
    </div>
    <div class="feature-card">
      <span class="feature-icon">üéØ</span>
      <h4>Job Role Matcher</h4>
      <p style="color:#94a3b8; font-size:14px;">See how well your profile fits specific job descriptions.</p>
    </div>
    <div class="feature-card">
      <span class="feature-icon">ü§ñ</span>
      <h4>AI Interview Coach</h4>
      <p style="color:#94a3b8; font-size:14px;">Practice with our AI bot for HR and Technical rounds.</p>
    </div>
    <div class="feature-card">
      <span class="feature-icon">üìú</span>
      <h4>Certificate Scanner</h4>
      <p style="color:#94a3b8; font-size:14px;">Scan certificates and generate resume-ready summaries.</p>
    </div>
  </div>

  <!-- How it Works -->
  <h2 class="section-title">How It Works</h2>
  <div class="steps-container">
    <div class="step-card"><div class="step-num">1</div><h4>Upload Resume</h4><p style="color:#94a3b8; font-size:13px;">Upload your PDF/DOCX to get an instant analysis.</p></div>
    <div class="step-card"><div class="step-num">2</div><h4>Optimize</h4><p style="color:#94a3b8; font-size:13px;">Fix gaps, keywords, and formatting with AI suggestions.</p></div>
    <div class="step-card"><div class="step-num">3</div><h4>Prepare</h4><p style="color:#94a3b8; font-size:13px;">Practice interviews and check your communication skills.</p></div>
    <div class="step-card"><div class="step-num">4</div><h4>Get Hired</h4><p style="color:#94a3b8; font-size:13px;">Apply with confidence using a top-tier resume.</p></div>
  </div>
</div>

<!-- LOGIN -->
<div id="login" class="card hidden">
<h2>Login</h2>
<input type="email" id="loginEmail" placeholder="Email">
<input type="password" placeholder="Password">
<button onclick="goUpload()">Login</button>
</div>

<!-- MAIN DASHBOARD CONTAINER -->
<div id="mainDashboard" class="hidden">

<!-- ANALYZE RESUME PANEL (NEW) -->
<div id="analyzePanel" class="hidden">
<div class="card" style="text-align:center; padding:40px;">
  <h2 style="color:#22d3ee;">AI Resume Analysis</h2>
  <p style="color:#cbd5f5; max-width:600px; margin:0 auto 30px auto;">
    Upload your resume to check its ATS compatibility, identify missing keywords, and get actionable improvement suggestions.
  </p>
  
  <div class="upload-zone" onclick="document.getElementById('analyzeResumeInput').click()" style="border:2px dashed #334155; border-radius:12px; padding:40px; cursor:pointer; transition:0.3s; background:#020617; max-width:500px; margin:auto;">
    <div style="font-size:40px; margin-bottom:15px;">üìÑ</div>
    <h3 style="margin:0; color:white;">Upload Resume</h3>
    <p style="color:#94a3b8; font-size:14px; margin-top:5px;">Supported formats: PDF, DOCX, DOC, TXT</p>
    <p style="color:#4ade80; font-size:12px; margin-top:10px; display:flex; align-items:center; justify-content:center; gap:5px;">üîí <span>Security: Files auto-deleted after analysis</span></p>
    <input type="file" id="analyzeResumeInput" accept=".doc,.docx,.pdf,.txt" style="display:none;" onchange="uploadResume(this)">
  </div>

  <div style="margin-top:40px; display:grid; grid-template-columns:repeat(auto-fit, minmax(200px, 1fr)); gap:20px; text-align:left;">
    <div style="background:#1e293b; padding:20px; border-radius:8px; border:1px solid #334155;">
      <h4 style="color:#4ade80; margin-top:0;">üìä ATS Scoring</h4>
      <p style="font-size:13px; color:#cbd5f5;">Get a score out of 100 based on industry standards.</p>
    </div>
    <div style="background:#1e293b; padding:20px; border-radius:8px; border:1px solid #334155;">
      <h4 style="color:#facc15; margin-top:0;">üîë Keyword Check</h4>
      <p style="font-size:13px; color:#cbd5f5;">Identify missing skills and keywords for your target role.</p>
    </div>
    <div style="background:#1e293b; padding:20px; border-radius:8px; border:1px solid #334155;">
      <h4 style="color:#f472b6; margin-top:0;">üí° Smart Tips</h4>
      <p style="font-size:13px; color:#cbd5f5;">Receive AI-driven suggestions to improve your content.</p>
    </div>
  </div>
</div>
</div>

<!-- RESUME PANEL -->
<div id="resumePanel">

<!-- SCORE -->
<div class="card">
<h2>Resume Score</h2>
<div id="resumeName" class="uploaded-file" style="text-align:center; margin-bottom:10px;"></div>
<canvas id="pieChart" width="200" height="200"></canvas>
<p id="scoreText" style="text-align:center;font-weight:bold"></p>
</div>

<!-- SECTION SCORES -->
<div class="card">
<h3>Resume Section Breakdown</h3>
<p>Skills</p><div class="progress"><div class="bar" style="width:80%;background:green;">80%</div></div>
<p>Experience</p><div class="progress"><div class="bar" style="width:70%;background:blue;">70%</div></div>
<p>Projects</p><div class="progress"><div class="bar" style="width:75%;background:orange;">75%</div></div>
<p>Education</p><div class="progress"><div class="bar" style="width:85%;background:green;">85%</div></div>
</div>

<!-- TABS -->
<div class="tabs">
<button onclick="show('summary')">Summary</button>
<button onclick="show('keywords')">ATS Keywords</button>
<button onclick="show('skills')">Skill Gaps</button>
<button onclick="show('jobs')">Job Match</button>
<button onclick="show('career')">Career Path</button>
<button onclick="show('roadmap')">Roadmap</button>
<button onclick="show('improve')">Improve</button>
<button onclick="show('editResume')">‚úçÔ∏è Edit in Word</button>
</div>

<!-- SECTIONS -->
<div id="summary" class="card section hidden">
<p>‚úî ATS friendly format</p>
<p>‚úî Strong frontend projects</p>
<p>‚ö† Deployment & system design missing</p>
</div>

<div id="keywords" class="card section hidden">
<h3>ATS Keyword Analysis</h3>
<p><b>Matched:</b> HTML, CSS, JavaScript, React</p>
<p><b>Missing:</b> Docker, REST API, CI/CD</p>
</div>

<div id="skills" class="card section hidden">
<h3>Skill Gap & Learning Suggestions</h3>
<div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px;">
  <div>
    <h4 style="color:#22d3ee; border-bottom:1px solid #334155; padding-bottom:5px;">üöÄ Technical Skills</h4>
    <p><b>Docker & Kubernetes:</b> Essential for modern deployment.<br><span style="color:#94a3b8; font-size:13px;">üëâ Learn via FreeCodeCamp & Official Docs</span></p>
    <p><b>GraphQL & REST APIs:</b> Critical for data fetching.<br><span style="color:#94a3b8; font-size:13px;">üëâ Practice with Apollo Client & Node.js</span></p>
    <p><b>TypeScript:</b> Industry standard for scalable apps.<br><span style="color:#94a3b8; font-size:13px;">üëâ Migrate a small JS project to TS</span></p>
    <p><b>System Design:</b> Key for senior roles.<br><span style="color:#94a3b8; font-size:13px;">üëâ Read "Grokking the System Design Interview"</span></p>
  </div>
  <div>
    <h4 style="color:#22d3ee; border-bottom:1px solid #334155; padding-bottom:5px;">üß† Soft & Process Skills</h4>
    <p><b>Agile/Scrum:</b> Understand sprint workflows.<br><span style="color:#94a3b8; font-size:13px;">üëâ Join open source projects using Jira/Trello</span></p>
    <p><b>CI/CD Pipelines:</b> Automate testing and deployment.<br><span style="color:#94a3b8; font-size:13px;">üëâ Set up GitHub Actions for your portfolio</span></p>
    <p><b>Code Reviewing:</b> Learn to give and receive feedback.<br><span style="color:#94a3b8; font-size:13px;">üëâ Review PRs on GitHub</span></p>
  </div>
</div>
</div>

<div id="jobs" class="card section hidden">
  <div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px;">
    <!-- LEFT: Role Matching -->
    <div>
      <h3>Job Role Matching</h3>
      <p>Frontend Developer</p>
      <div class="progress"><div class="bar" style="width:85%;background:green;">85%</div></div>
      <p>UI Engineer</p>
      <div class="progress"><div class="bar" style="width:78%;background:blue;">78%</div></div>
      <p>Web Developer</p>
      <div class="progress"><div class="bar" style="width:72%;background:orange;">72%</div></div>
      <h4>Why Recommended?</h4>
      <ul>
      <li>Strong UI skills</li>
      <li>Good React projects</li>
      <li>Needs optimization knowledge</li>
      </ul>
    </div>

    <!-- RIGHT: JD Matching -->
    <div style="border-left:1px solid #334155; padding-left:20px;">
      <h3>Job Description Match</h3>
      <p style="font-size:14px; color:#cbd5f5;">Paste a JD or upload to compare.</p>
      <textarea id="jdInput" placeholder="Paste Job Description text here..." style="width:100%; height:120px; background:#0f172a; color:white; border:1px solid #334155; border-radius:8px; padding:10px; resize:vertical;"></textarea>
      <div style="margin:10px 0;">
        <input type="file" id="jdFile" accept=".txt,.doc,.docx,.pdf" onchange="handleJDUpload(this)" style="font-size:12px; color:#cbd5f5;">
      </div>
      <button onclick="analyzeJD()" style="width:100%;">Compare Resume vs JD</button>
    </div>
  </div>

  <!-- JD ANALYSIS RESULTS -->
  <div id="jdResults" class="hidden" style="margin-top:30px; border-top:1px solid #334155; padding-top:20px;">
    <h3 style="color:#22d3ee; text-align:center;">JD Comparison Analysis</h3>
    
    <!-- Score -->
    <div style="text-align:center; margin-bottom:20px;">
      <div style="font-size:36px; font-weight:bold; color:#4ade80;" id="jdScore">0%</div>
      <div style="color:#cbd5f5;">Match Score</div>
    </div>

    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px; margin-bottom:20px;">
      <!-- Missing Skills -->
      <div style="background:#0f172a; padding:15px; border-radius:8px;">
        <h4 style="color:#f87171; margin-top:0;">‚ùå Missing Skills</h4>
        <ul id="jdMissing" style="padding-left:20px; color:#cbd5f5;"></ul>
      </div>
      <!-- Recommended Edits -->
      <div style="background:#0f172a; padding:15px; border-radius:8px;">
        <h4 style="color:#facc15; margin-top:0;">‚úèÔ∏è Recommended Edits</h4>
        <ul id="jdEdits" style="padding-left:20px; color:#cbd5f5;"></ul>
      </div>
    </div>

    <!-- Comparison Table -->
    <h4 style="color:#22d3ee;">üìä Side-by-Side Comparison</h4>
    <table class="comp-table" style="width:100%; border-collapse:collapse; color:#cbd5f5; font-size:14px;">
      <thead>
        <tr style="background:#334155; text-align:left;">
          <th>Category</th>
          <th>Job Requirement</th>
          <th>Your Resume</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody id="jdTableBody"></tbody>
    </table>
  </div>
</div>

<div id="career" class="card section hidden">
<h3>Career Path Recommendation</h3>
<div style="position:relative; padding-left:20px; border-left:2px solid #22d3ee;">
  <div style="margin-bottom:20px; position:relative;">
    <div style="position:absolute; left:-26px; top:0; background:#22d3ee; width:10px; height:10px; border-radius:50%;"></div>
    <h4 style="margin:0; color:#22d3ee;">Current: Junior Frontend Developer</h4>
    <p style="margin:5px 0; font-size:14px; color:#cbd5f5;">Focus: Mastering React, CSS Grid/Flexbox, Basic API Integration.</p>
    <span style="background:#334155; padding:2px 8px; border-radius:4px; font-size:12px;">Est. Salary: ‚Çπ4L - ‚Çπ8L</span>
  </div>
  
  <div style="margin-bottom:20px; position:relative;">
    <div style="position:absolute; left:-26px; top:0; background:#22d3ee; width:10px; height:10px; border-radius:50%;"></div>
    <h4 style="margin:0; color:#22d3ee;">6-12 Months: Mid-Level Frontend Developer</h4>
    <p style="margin:5px 0; font-size:14px; color:#cbd5f5;">Focus: State Management (Redux), Unit Testing (Jest), Performance Optimization.</p>
    <span style="background:#334155; padding:2px 8px; border-radius:4px; font-size:12px;">Est. Salary: ‚Çπ10L - ‚Çπ18L</span>
  </div>

  <div style="margin-bottom:20px; position:relative;">
    <div style="position:absolute; left:-26px; top:0; background:#22d3ee; width:10px; height:10px; border-radius:50%;"></div>
    <h4 style="margin:0; color:#22d3ee;">2+ Years: Full Stack Engineer</h4>
    <p style="margin:5px 0; font-size:14px; color:#cbd5f5;">Focus: Backend (Node/Python), Databases (SQL/NoSQL), Cloud (AWS/Azure).</p>
    <span style="background:#334155; padding:2px 8px; border-radius:4px; font-size:12px;">Est. Salary: ‚Çπ20L - ‚Çπ30L</span>
  </div>

  <div style="position:relative;">
    <div style="position:absolute; left:-26px; top:0; background:#22d3ee; width:10px; height:10px; border-radius:50%;"></div>
    <h4 style="margin:0; color:#22d3ee;">5+ Years: Senior Software Architect / Tech Lead</h4>
    <p style="margin:5px 0; font-size:14px; color:#cbd5f5;">Focus: System Architecture, Team Leadership, Strategic Planning.</p>
    <span style="background:#334155; padding:2px 8px; border-radius:4px; font-size:12px;">Est. Salary: ‚Çπ35L+</span>
  </div>
</div>
</div>

<div id="roadmap" class="card section hidden">
<h3>Learning Roadmap</h3>
<div class="flowchart">
<div class="flow-box">Resume Analysis</div><div class="arrow">‚¨á</div>
<div class="flow-box">HTML ‚Ä¢ CSS ‚Ä¢ JavaScript</div><div class="arrow">‚¨á</div>
<div class="flow-box">React / Backend</div><div class="arrow">‚¨á</div>
<div class="flow-box">APIs & Databases</div><div class="arrow">‚¨á</div>
<div class="flow-box">Docker & Deployment</div><div class="arrow">‚¨á</div>
<div class="flow-box">System Design</div><div class="arrow">‚¨á</div>
<div class="flow-box">üéØ Job Ready</div>
</div>
</div>

<div id="improve" class="card section hidden">
<h3>Resume Improvement Guide</h3>
<div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px;">
  <div>
    <h4 style="color:#22d3ee; border-bottom:1px solid #334155; padding-bottom:5px;">‚ú® Content Enhancements</h4>
    <ul style="padding-left:20px; color:#cbd5f5; line-height:1.6;">
      <li><b>Action Verbs:</b> Replace "Responsible for" with <i>Spearheaded, Developed, Optimized</i>.</li>
      <li><b>Metrics:</b> "Improved performance" ‚Üí "Boosted load speeds by 35%".</li>
      <li><b>Impact:</b> Focus on what you achieved, not just what you did.</li>
    </ul>
  </div>
  <div>
    <h4 style="color:#22d3ee; border-bottom:1px solid #334155; padding-bottom:5px;">üõ† Formatting & ATS</h4>
    <ul style="padding-left:20px; color:#cbd5f5; line-height:1.6;">
      <li><b>Clean Layout:</b> Avoid tables, columns, and graphics for better ATS parsing.</li>
      <li><b>Keywords:</b> Include skills like <i>Docker, CI/CD, TypeScript</i> naturally in bullets.</li>
      <li><b>Length:</b> Keep it to 1 page for &lt;10 years experience.</li>
    </ul>
  </div>
</div>
<button onclick="downloadReport()" style="margin-top:20px; width:100%; font-weight:bold;">Download Detailed AI Report</button>
</div>

<div id="editResume" class="card section hidden">
  <h3>‚úçÔ∏è Download as Editable Word Doc</h3>
  <p style="color:#cbd5f5;">Instead of struggling with your original file's formatting, download your resume content within a professionally structured, fully editable Microsoft Word template.</p>
  <p style="color:#94a3b8; font-size:13px;">This ensures your document is ATS-friendly and ready for your improvements. Just replace the placeholder text with your details.</p>
  <button onclick="downloadForEditing()" style="margin-top:20px; width:100%; font-weight:bold; padding:12px;">Download Editable .DOC Template</button>
</div>

</div> <!-- END RESUME PANEL -->

<!-- INTERVIEW PANEL -->
<div id="interviewPanel" class="hidden">
  <div class="card" style="background: #020617; border: 1px solid #334155; box-shadow: 0 0 30px rgba(34, 211, 238, 0.1);">
    <!-- Setup "Lobby" -->
    <div id="interviewSetup">
      <h3 style="text-align:center; color:#22d3ee; font-size:24px;">AI Interview Simulator</h3>
      <p style="text-align:center; color:#94a3b8; max-width:500px; margin:auto; margin-bottom:30px;">Prepare for your next interview by practicing with our AI coach. Select your role and the interview type to begin.</p>
      <div style="text-align:center; margin-bottom:30px;">
        <img src="https://cdn-icons-png.flaticon.com/512/6134/6134346.png" alt="AI Interviewer" style="width:120px; height:120px; border-radius:50%; box-shadow: 0 0 20px rgba(34, 211, 238, 0.3); background: rgba(34, 211, 238, 0.1); padding: 15px; animation: float 3s ease-in-out infinite;">
      </div>
      <div style="max-width:400px; margin:auto; background:#0f172a; padding:20px; border-radius:12px;">
        <label><b>Select Job Role</b></label>
        <select id="intRole">
          <option value="frontend">Frontend Developer</option>
          <option value="backend">Backend Developer</option>
          <option value="fullstack">Full Stack Developer</option>
          <option value="dataAnalyst">Data Analyst</option>
          <option value="aiEngineer">AI/ML Engineer</option>
        </select>
        
        <label><b>Interview Type</b></label>
        <select id="intType">
          <option value="hr">HR Round</option>
          <option value="technical">Technical Round</option>
          <option value="general">General Behavioral</option>
        </select>

        <button onclick="startInterviewBot()" style="width:100%; font-weight:bold; padding:12px;">Start Interview</button>
      </div>
    </div>

    <!-- Main Interview UI -->
    <div id="interviewChatArea" class="hidden">
      <div class="chatbot" style="padding:0; max-width:none; margin:0;">
        <!-- Header with Progress -->
        <div class="chat-header" style="border-radius: 12px 12px 0 0; display:flex; justify-content:space-between; align-items:center; padding:15px; background:#1e293b;">
          <div>
            <span style="font-size:18px;">ü§ñ AI Interview Coach</span>
            <div id="intProgress" style="font-size:12px; color:#94a3b8;">Question 0 of 5</div>
          </div>
          <div style="text-align:right;">
            <span id="intTimer" style="font-size:14px; color:#cbd5f5;">00:00</span>
            <button onclick="endInterviewSession()" style="background:#ef4444; color:white; border:none; padding:5px 10px; border-radius:6px; font-size:12px; margin-left:15px; margin-top:0; cursor:pointer;">End Session</button>
          </div>
        </div>
        <div class="chat-box" id="intChatBox" style="border-radius:0;"></div>
        
        <div id="intLiveFeedback" class="hidden live-feedback" style="border-radius:0; margin:0; border-left:0; border-right:0;">
          <div style="display:flex; align-items:center; gap:10px;">
            <span style="color:#f87171; font-weight:bold; animation: pulse 1.5s infinite;">‚óè Live Analysis</span>
            <span id="liveWordCount" style="color:#cbd5f5; font-size:13px;">0 Words</span>
          </div>
          <div id="liveKeywords" style="display:flex; gap:5px; flex-wrap:wrap;"></div>
        </div>

        <div style="display:flex; gap:10px; padding:15px; background:#1e293b; border-radius: 0 0 12px 12px;" id="intInputArea">
          <input type="text" id="intUserInput" placeholder="Type your answer..." style="flex:1; padding:10px; border-radius:8px; border:1px solid #334155;" onkeydown="if(event.key === 'Enter') sendIntMsg()">
          <button onclick="sendIntMsg()" style="background:#22d3ee; color:#0f172a; border:none; padding:10px 15px; border-radius:8px; cursor:pointer;">Send</button>
          <button id="intMicBtn" onclick="startIntMic()" style="background:#22d3ee; color:#0f172a; border:none; padding:10px 15px; border-radius:8px; cursor:pointer; font-weight:bold;">üé§ Microphone</button>
        </div>
      </div>
    </div>
    <div id="interviewReport" class="hidden"></div>
  </div>
</div>

<!-- CERTIFICATE SCANNER PANEL -->
<div id="certificatePanel" class="hidden">
<div class="card">
<button onclick="showHome()" style="background:none; border:none; color:#cbd5f5; cursor:pointer; margin-bottom:15px; font-size:14px;">&larr; Back to Home</button>
<div style="text-align:center; margin-bottom:30px;">
  <div style="font-size:60px; margin-bottom:10px; animation: float 3s ease-in-out infinite; display:inline-block;">üìú</div>
  <h3 style="color:#22d3ee; font-size:28px; margin:0;">Certificate Scanner & Analyzer</h3>
  <p style="color:#94a3b8; margin-top:10px;">Upload your certificate to generate a professional resume bullet point.</p>
</div>

<div style="max-width: 600px; margin: 0 auto;">
  <!-- UPLOAD ZONE -->
  <div class="upload-zone" onclick="document.getElementById('certInput').click()" style="border:2px dashed #334155; border-radius:12px; padding:40px; cursor:pointer; transition:0.3s; background:#020617; text-align:center; margin-bottom: 20px;">
    <div style="font-size:40px; margin-bottom:15px;">üì§</div>
    <h3 style="margin:0; color:white;">Upload Certificate</h3>
    <p style="color:#94a3b8; font-size:14px; margin-top:5px;">Supported formats: JPG, PNG, PDF</p>
    <input type="file" id="certInput" accept=".jpg,.jpeg,.png,.pdf" style="display:none;" onchange="handleCertUpload(this)">
    <p id="certFileName" style="color:#22d3ee; font-weight:bold; margin-top:10px;"></p>
  </div>

  <!-- COURSE NAME INPUT -->
  <div style="margin-bottom: 20px; text-align: left;">
    <label style="display:block; margin-bottom:8px; color:#22d3ee; font-weight:bold;">Course / Certification Name</label>
    <input type="text" id="certNameInput" placeholder="e.g. Advanced React Patterns, AWS Solutions Architect" style="width:100%; padding:12px; border-radius:8px; border:1px solid #334155; background:#020617; color:white;">
  </div>

  <!-- ANALYZE BUTTON -->
  <button onclick="analyzeCertificate()" style="width:100%; padding:15px; background:linear-gradient(90deg, #22d3ee, #3b82f6); color:#0f172a; font-weight:bold; border:none; border-radius:8px; cursor:pointer; font-size:16px;">üîç Analyze & Generate Sentence</button>

  <!-- OUTPUT -->
  <div id="certOutput" class="hidden" style="background:#0f172a; padding:20px; border-radius:10px; border:1px solid #22d3ee; margin-top: 20px;">
      <h4 style="color:#4ade80; margin-top:0; display:flex; justify-content:space-between; align-items:center;">
        ‚ú® Generated Resume Sentence
        <button onclick="copyCertText()" style="background:none; border:none; color:#cbd5f5; cursor:pointer; font-size:12px;">üìã Copy</button>
      </h4>
      <div id="certResult" style="color:#cbd5f5; line-height:1.6; white-space: pre-wrap; font-style: italic;"></div>
  </div>
</div>
</div>
</div>

<!-- TEMPLATES PANEL -->
<div id="templatesPanel" class="hidden">
<div class="card">
  <button onclick="showHome()" style="background:none; border:none; color:#cbd5f5; cursor:pointer; margin-bottom:15px; font-size:14px;">&larr; Back to Home</button>
  <h3>Resume Templates Gallery</h3>
  <p style="color:#cbd5f5; margin-bottom:20px;">Select a template to view or download as an editable Word document.</p>
  <div id="templatesGrid" style="display:grid; grid-template-columns: repeat(3, 1fr); gap:20px;"></div>
</div>
</div>

<!-- VIDEO SIMULATOR PANEL -->
<div id="videoSimPanel" class="hidden">
<div class="card">
  <button onclick="showHome()" style="background:none; border:none; color:#cbd5f5; cursor:pointer; margin-bottom:15px; font-size:14px;">&larr; Back to Home</button>
  <h3>Video Interview Simulator</h3>
  <p style="color:#cbd5f5;">Simulates a real interview environment. Analyzes video presence (eye contact, posture) and audio signals (sentiment, clarity, confidence) simultaneously.</p>
  
  <div style="background:#020617; padding:20px; border-radius:12px; margin-top:20px;">
    
    <!-- Main Display Area -->
    <div style="display:flex; gap:20px; align-items:center;">
        <!-- Left Pane: Video/Placeholder -->
        <div style="flex:2;">
            <!-- Combined Container -->
            <div id="videoContainer" style="position:relative; aspect-ratio: 1 / 1; border:2px dashed #334155; border-radius:8px; background:#0f172a; transition: all 0.5s ease; overflow:hidden;">
                <div id="videoPlaceholder" style="width:100%; height:100%; display:flex; align-items:center; justify-content:center; color:#334155;">
                    <span>Camera Preview Area</span>
                </div>
                <video id="videoFeed" class="hidden" style="width:100%; height:100%; object-fit:cover; border-radius:8px; position:absolute; top:0; left:0;" autoplay muted playsinline></video>
                <div id="microTipsContainer" style="position:absolute; top:0; left:0; right:0; bottom:0; overflow:hidden; pointer-events:none;"></div>
            </div>
        </div>
        <!-- Right Pane: AI Robot & Live Metrics -->
        <div style="flex:1; background:#0f172a; padding:20px; border-radius:12px; text-align:center; display:flex; flex-direction:column; justify-content:center; border:1px solid #334155; min-height: 300px;">
            <img src="https://cdn-icons-png.flaticon.com/512/6134/6134346.png" alt="AI Interviewer" style="width:80px; height:80px; border-radius:50%; margin: 0 auto 15px auto; animation: float 3s ease-in-out infinite;">
            <h4 style="color:#22d3ee; margin:0 0 20px 0;">Live Analysis</h4>
            <div id="liveMetricsContainer" style="text-align:left;">
                <div style="margin-bottom:15px;">
                    <label style="font-size:12px; color:#cbd5f5; display:block;">Confidence</label>
                    <div class="progress" style="margin:5px 0; height:10px;"><div id="liveConfidenceBar" class="bar" style="width:0%; background:#4ade80; height:10px;"></div></div>
                </div>
                <div style="margin-bottom:20px;">
                    <label style="font-size:12px; color:#cbd5f5; display:block;">Clarity</label>
                    <div class="progress" style="margin:5px 0; height:10px;"><div id="liveClarityBar" class="bar" style="width:0%; background:#22d3ee; height:10px;"></div></div>
                </div>
                <div style="text-align:center;">
                    <span id="liveSentiment" style="background:#334155; color:#cbd5f5; padding:4px 12px; border-radius:15px; font-weight:bold; font-size:12px; transition: all 0.3s ease;">NEUTRAL</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Controls Area -->
    <div style="margin-top:20px; text-align:center;">
        <!-- Audio Visualizer -->
        <div id="audioVisualizer" style="height:60px; background:#0f172a; margin-bottom:15px; display:flex; align-items:center; justify-content:center; border-radius:8px; border:1px solid #334155; max-width:100%;">
          <div id="waveAnim" class="hidden" style="display:flex; gap:5px; align-items:center;">
            <div style="width:5px; height:20px; background:#22d3ee; animation: wave 1s infinite;"></div>
            <div style="width:5px; height:40px; background:#22d3ee; animation: wave 1.2s infinite;"></div>
            <div style="width:5px; height:30px; background:#22d3ee; animation: wave 0.8s infinite;"></div>
            <div style="width:5px; height:50px; background:#22d3ee; animation: wave 1.5s infinite;"></div>
            <div style="width:5px; height:25px; background:#22d3ee; animation: wave 1.1s infinite;"></div>
          </div>
          <span id="waveText" style="color:#334155; font-size:12px;">Audio Signal</span>
        </div>
        <!-- Buttons -->
        <div style="display:flex; gap:15px; justify-content:center;">
            <button onclick="startVideo()" id="startVideoBtn">Start Video Interview</button>
            <button onclick="stopVideo()" id="stopVideoBtn" class="hidden" style="background:#ef4444;">Stop & Analyze</button>
        </div>
    </div>

  </div>
  <div id="videoReport" class="hidden" style="margin-top:20px;"></div>
</div>
</div>

<!-- COMMUNICATION PANEL -->
<div id="communicationPanel" class="hidden">
<div class="card">
  <div class="comm-layout">
    <!-- Left side: Visualizer & Live Metrics -->
    <div class="comm-visuals" style="flex:1; display:flex; flex-direction:column; align-items:center; justify-content:center; background:#020617; border-radius:16px; padding:20px; border:1px solid #334155; min-height:400px;">
      <div id="commAvatar" style="font-size:80px; margin-bottom:20px; animation: float 3s ease-in-out infinite;">ü§ñ</div>
      <h3 style="color:#22d3ee; margin:0;">AI Speech Coach</h3>
      <p style="color:#94a3b8; text-align:center; font-size:14px;">I'm analyzing your tone, pace, and clarity in real-time.</p>
      
      <!-- Live Metrics (Hidden until start) -->
      <div id="commLiveMetrics" class="hidden" style="width:100%; margin-top:30px;">
        <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
          <span style="color:#cbd5f5;">Speaking Pace</span>
          <span id="livePace" style="color:#4ade80; font-weight:bold;">0 WPM</span>
        </div>
        <div class="progress" style="height:8px;"><div id="paceBar" class="bar" style="width:0%; background:#22d3ee; height:8px;"></div></div>
        
        <div style="display:flex; justify-content:space-between; margin-top:20px; margin-bottom:10px;">
          <span style="color:#cbd5f5;">Filler Words Detected</span>
          <span id="liveFillers" style="color:#f87171; font-weight:bold;">0</span>
        </div>
        
        <div id="commWordCloud" style="margin-top:20px; height:120px; overflow:hidden; display:flex; flex-wrap:wrap; gap:5px; justify-content:center; align-content:start;"></div>
      </div>
    </div>

    <!-- Right side: Controls & Chat -->
    <div class="comm-chat-wrapper" style="flex:1;">
      <div class="chatbot" id="commChatArea" style="height:100%; display:flex; flex-direction:column; justify-content:center;">
        <div class="chat-header">üé§ JAM Session (Just A Minute)</div>
        
        <div id="commIntro" style="text-align:center; padding:20px;">
          <p style="color:#cbd5f5; margin-bottom:20px;">Select a topic to begin your 1-minute speech analysis.</p>
          <div class="topic-btns" id="topics" style="display:flex; flex-wrap:wrap; justify-content:center; gap:10px;">
            <button onclick="selectCommTopic('Importance of AI')">Importance of AI</button>
            <button onclick="selectCommTopic('Role of Engineers')">Role of Engineers</button>
            <button onclick="selectCommTopic('Future of Technology')">Future of Technology</button>
            <button onclick="selectCommTopic('Social Media Impact')">Social Media Impact</button>
            <button onclick="selectCommTopic('Remote Work Culture')">Remote Work Culture</button>
          </div>
        </div>

        <div id="commActiveArea" class="hidden" style="flex:1; display:flex; flex-direction:column; align-items:center; justify-content:center; padding:20px;">
          <h2 id="activeTopic" style="color:white; text-align:center; margin-bottom:10px;">Topic</h2>
          <div id="commTimer" style="font-size:48px; font-weight:bold; color:#22d3ee; margin:20px 0;">01:00</div>
          <div id="commInstructions" style="color:#94a3b8; margin-bottom:20px;">Click microphone to start speaking</div>
          <button id="commMicBtn" onclick="startMic()" style="background:#22d3ee; color:#0f172a; border:none; width:80px; height:80px; border-radius:50%; font-size:32px; cursor:pointer; box-shadow:0 0 20px rgba(34,211,238,0.5); transition:0.3s; display:flex; align-items:center; justify-content:center;">üéô</button>
          <button id="commStopBtn" onclick="stopCommTest()" class="hidden" style="background:#ef4444; color:white; border:none; padding:15px 30px; border-radius:30px; font-size:18px; cursor:pointer; margin-top:20px;">‚èπ Stop & Analyze</button>
        </div>

        <div class="chat-box hidden" id="chatBox"></div> <!-- Hidden, used for transcript storage -->
      </div>
      <div id="commReport" class="hidden"></div>
    </div>
  </div>
</div>
</div>

<!-- COVER LETTER PANEL -->
<div id="coverLetterPanel" class="hidden">
<div class="card">
  <button onclick="showHome()" style="background:none; border:none; color:#cbd5f5; cursor:pointer; margin-bottom:15px; font-size:14px;">&larr; Back to Home</button>
  <h3>AI Cover Letter Generator</h3>
  <p style="color:#cbd5f5;">Generate a tailored cover letter based on your resume and the job description.</p>
  
  <div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px; margin-top:20px;">
    <div>
      <label style="display:block; margin-bottom:5px; color:#22d3ee;">Job Title</label>
      <input type="text" id="clJobTitle" placeholder="e.g. Frontend Developer">
      
      <label style="display:block; margin-bottom:5px; color:#22d3ee;">Company Name</label>
      <input type="text" id="clCompany" placeholder="e.g. Tech Corp">
      
      <label style="display:block; margin-bottom:5px; color:#22d3ee;">Hiring Manager (Optional)</label>
      <input type="text" id="clManager" placeholder="e.g. Jane Doe">
      
      <button onclick="generateCoverLetter()" style="width:100%; margin-top:15px;">‚ú® Generate Cover Letter</button>
    </div>
    <div>
      <textarea id="clOutput" placeholder="Your AI-generated cover letter will appear here..." style="width:100%; height:300px; background:#0f172a; color:white; border:1px solid #334155; border-radius:8px; padding:15px; resize:vertical;"></textarea>
      <button onclick="copyToClipboard('clOutput')" style="margin-top:10px; background:#334155;">üìã Copy Text</button>
    </div>
  </div>
</div>
</div>

<!-- SALARY ESTIMATION PANEL -->
<div id="salaryPanel" class="hidden">
<div class="card">
  <button onclick="showHome()" style="background:none; border:none; color:#cbd5f5; cursor:pointer; margin-bottom:15px; font-size:14px;">&larr; Back to Home</button>
  <h3>üí∞ Salary Estimation AI</h3>
  <p style="color:#cbd5f5;">Predicts expected salary range based on role, skills, and experience.</p>
  
  <div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px; margin-top:20px;">
    <div>
      <label style="display:block; margin-bottom:5px; color:#22d3ee;">Job Role</label>
      <input type="text" id="salRole" placeholder="e.g. Full Stack Developer">
      
      <label style="display:block; margin-bottom:5px; color:#22d3ee;">Years of Experience</label>
      <input type="number" id="salExp" placeholder="e.g. 3">
      
      <label style="display:block; margin-bottom:5px; color:#22d3ee;">Location</label>
      <input type="text" id="salLoc" placeholder="e.g. Bangalore, Remote">
      
      <label style="display:block; margin-bottom:5px; color:#22d3ee;">Top Skills</label>
      <input type="text" id="salSkills" placeholder="e.g. React, Python, AWS">
      
      <button onclick="estimateSalary()" style="width:100%; margin-top:15px;">üìä Estimate Salary</button>
    </div>
    <div id="salaryResult" class="hidden" style="background:#0f172a; padding:20px; border-radius:12px; border:1px solid #334155; display:flex; flex-direction:column; justify-content:center; align-items:center; text-align:center;">
      <h4 style="color:#cbd5f5; margin:0;">Estimated Annual Salary</h4>
      <div style="font-size:36px; font-weight:bold; color:#4ade80; margin:10px 0;" id="salRange">‚Çπ0 - ‚Çπ0</div>
      <p style="color:#94a3b8; font-size:14px;" id="salDesc"></p>
      
      <div style="width:100%; margin-top:20px; text-align:left;">
        <h5 style="color:#22d3ee; border-bottom:1px solid #334155; padding-bottom:5px;">Factors Considered</h5>
        <ul style="color:#cbd5f5; font-size:13px; padding-left:20px;" id="salFactors"></ul>
      </div>
    </div>
  </div>
</div>
</div>

<!-- DISCOVERY PANEL -->
<div id="discoveryPanel" class="hidden">
<div class="card">
  <button onclick="showHome()" style="background:none; border:none; color:#cbd5f5; cursor:pointer; margin-bottom:15px; font-size:14px;">&larr; Back to Home</button>
  <h3>üåç Location-Based Company & Job Discovery</h3>
  <p style="color:#cbd5f5;">Explore top companies and hiring trends in your preferred city.</p>
  
  <div style="margin-top:20px; max-width:400px;">
    <label style="display:block; margin-bottom:5px; color:#22d3ee;">Enter Location</label>
    <div style="display:flex; gap:10px;">
      <input type="text" id="discLocation" placeholder="Type city name (e.g. Bangalore)" style="flex:1; padding:12px; background:#0f172a; color:white; border:1px solid #334155; border-radius:8px;" onkeydown="if(event.key === 'Enter') updateDiscovery()">
      <button onclick="updateDiscovery()" style="background:#22d3ee; color:#0f172a; border:none; padding:0 20px; border-radius:8px; font-weight:bold; cursor:pointer;">Search</button>
    </div>
  </div>

  <div id="discoveryResults" style="margin-top:30px;">
    <p style="text-align:center; color:#64748b; margin-top:50px;">Select a location to view companies.</p>
  </div>
</div>
</div>

<!-- PROFILE PANEL -->
<div id="profilePanel" class="hidden">
<div class="card">
  <button onclick="showHome()" style="background:none; border:none; color:#cbd5f5; cursor:pointer; margin-bottom:15px; font-size:14px;">&larr; Back to Home</button>
  <h3>üë§ User Profile & Preferences</h3>
  
  <div style="display:grid; grid-template-columns: 1fr 1fr; gap:30px;">
    <!-- Personal Info -->
    <div>
      <h4 style="color:#22d3ee; border-bottom:1px solid #334155; padding-bottom:5px; margin-top:0;">Personal Details</h4>
      <label style="display:block; margin-bottom:5px; color:#cbd5f5;">Full Name</label>
      <input type="text" id="pName" placeholder="Enter your name" disabled>
      
      <label style="display:block; margin-bottom:5px; color:#cbd5f5; margin-top:10px;">Email Address</label>
      <input type="email" id="pEmail" placeholder="email@example.com" disabled>
      
      <label style="display:block; margin-bottom:5px; color:#cbd5f5; margin-top:10px;">Experience Level</label>
      <select id="pExp" disabled>
        <option value="Fresher">Fresher (0-1 Years)</option>
        <option value="Junior">Junior (1-3 Years)</option>
        <option value="Mid">Mid-Level (3-5 Years)</option>
        <option value="Senior">Senior (5+ Years)</option>
      </select>
    </div>

    <!-- Career Info -->
    <div>
      <h4 style="color:#22d3ee; border-bottom:1px solid #334155; padding-bottom:5px; margin-top:0;">Career Preferences</h4>
      <label style="display:block; margin-bottom:5px; color:#cbd5f5;">Preferred Job Roles</label>
      <input type="text" id="pRoles" placeholder="e.g. Frontend Developer, Data Scientist" disabled>
      
      <label style="display:block; margin-bottom:5px; color:#cbd5f5; margin-top:10px;">Top Skills</label>
      <input type="text" id="pSkills" placeholder="e.g. React, Python, AWS" disabled>
      
      <label style="display:block; margin-bottom:5px; color:#cbd5f5; margin-top:10px;">Career Interests</label>
      <input type="text" id="pInterests" placeholder="e.g. Startups, Remote Work, AI" disabled>
    </div>
  </div>

  <!-- Security -->
  <div style="margin-top:30px; background:#020617; padding:20px; border-radius:8px; border:1px solid #334155;">
    <h4 style="color:#f87171; margin-top:0;">üîê Security & Login</h4>
    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px;">
      <div>
        <label style="display:block; margin-bottom:5px; color:#cbd5f5;">New Password</label>
        <input type="password" id="pNewPass" placeholder="New Password" disabled>
      </div>
      <div>
        <label style="display:block; margin-bottom:5px; color:#cbd5f5;">Confirm Password</label>
        <input type="password" id="pConfirmPass" placeholder="Confirm Password" disabled>
      </div>
    </div>
  </div>

  <div style="display:flex; gap:15px; margin-top:20px;">
    <button onclick="toggleEdit()" style="flex:1; background:#334155; color:white; font-weight:bold; padding:12px; border-radius:8px;">‚úèÔ∏è Edit Profile</button>
    <button onclick="saveProfile()" id="saveProfileBtn" disabled style="flex:1; background:linear-gradient(90deg, #22d3ee, #3b82f6); color:#0f172a; font-weight:bold; padding:12px; border-radius:8px; opacity:0.5; cursor:not-allowed;">Save Profile & Update Preferences</button>
  </div>
</div>
</div>

<!-- DOWNLOAD HISTORY PANEL -->
<div id="historyPanel" class="hidden">
<div class="card">
  <button onclick="showHome()" style="background:none; border:none; color:#cbd5f5; cursor:pointer; margin-bottom:15px; font-size:14px;">&larr; Back to Home</button>
  <h3>üìú Activity & Resume History</h3>
  
  <!-- Resume Score Analysis -->
  <div style="margin-bottom: 30px; border-bottom: 1px solid #334155; padding-bottom: 20px;">
    <h4 style="color:#22d3ee;">üìà Resume Score Progression</h4>
    <div style="display:flex; gap:20px; align-items:center; flex-wrap:wrap;">
      <div style="flex:1; min-width:300px; background:#020617; padding:10px; border-radius:8px; border:1px solid #334155;">
         <canvas id="historyChart" height="200" style="width:100%;"></canvas>
      </div>
      <div style="width:200px; text-align:center; background:#1e293b; padding:20px; border-radius:12px;">
         <div style="font-size:14px; color:#cbd5f5;">Latest Score</div>
         <div id="histLatestScore" style="font-size:42px; font-weight:bold; color:#4ade80;">-</div>
         <div id="histDiff" style="font-size:14px; margin-top:5px; font-weight:bold;"></div>
      </div>
    </div>
  </div>

  <h4 style="color:#22d3ee;">üìÑ Uploaded Resumes</h4>
  <table class="comp-table" style="width:100%; border-collapse:collapse; color:#cbd5f5; margin-bottom:30px;">
    <thead><tr style="background:#334155; text-align:left;"><th>Date</th><th>File Name</th><th>Score</th><th>View</th></tr></thead>
    <tbody id="uploadHistoryBody"></tbody>
  </table>

  <h4 style="color:#22d3ee;">üìÇ Download Log</h4>
  <table class="comp-table" style="width:100%; border-collapse:collapse; color:#cbd5f5; margin-top:20px;">
    <thead><tr style="background:#334155; text-align:left;"><th>Date</th><th>Item</th><th>Action</th></tr></thead>
    <tbody id="historyTableBody"></tbody>
  </table>
</div>
</div>

<!-- GAMES PANEL -->
<div id="gamesPanel" class="hidden">
<div class="card">
  <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
    <button onclick="showHome()" style="background:none; border:none; color:#cbd5f5; cursor:pointer;">&larr; Back to Home</button>
    <div style="background:#0f172a; padding:8px 15px; border-radius:20px; border:1px solid #22d3ee; color:#22d3ee; font-weight:bold; display:flex; align-items:center; gap:10px;">
      <span>üèÜ Rank: <span id="gameRank">Novice</span></span>
      <span style="background:#334155; padding:2px 8px; border-radius:10px; color:white; font-size:12px;">XP: <span id="gameXP">0</span></span>
    </div>
  </div>

  <div id="gamesLobby">
    <h3 style="color:#22d3ee; text-align:center; margin-top:0;">üéÆ Career Prep Arcade</h3>
    <p style="text-align:center; color:#cbd5f5; margin-bottom:30px;">Gamify your interview preparation. Earn XP to unlock badges!</p>
    
    <div class="features-grid" style="grid-template-columns: repeat(2, 1fr);">
      <!-- Game Cards -->
      <div class="feature-card" onclick="launchGame(1)" style="cursor:pointer;">
        <span class="feature-icon">üéô</span><h4>Fill the Silence</h4><p style="font-size:13px; color:#94a3b8;">Complete the sentence naturally.</p>
      </div>
      <div class="feature-card" onclick="launchGame(2)" style="cursor:pointer;">
        <span class="feature-icon">üöÄ</span><h4>Project Pitch</h4><p style="font-size:13px; color:#94a3b8;">Pitch your project in 60s.</p>
      </div>
      <div class="feature-card" onclick="launchGame(6)" style="cursor:pointer;">
        <span class="feature-icon">üé≠</span><h4>HR Drama Sim</h4><p style="font-size:13px; color:#94a3b8;">Handle tricky scenarios.</p>
      </div>
      <div class="feature-card" onclick="launchGame(7)" style="cursor:pointer;">
        <span class="feature-icon">‚òéÔ∏è</span><h4>Client Call Chaos</h4><p style="font-size:13px; color:#94a3b8;">Calm an angry client.</p>
      </div>
    </div>
  </div>

  <!-- Active Game Container -->
  <div id="activeGameContainer" class="hidden" style="background:#020617; padding:30px; border-radius:12px; border:1px solid #334155; min-height:400px; position:relative;">
    <button onclick="exitGame()" style="position:absolute; top:15px; right:15px; background:#ef4444; color:white; border:none; padding:5px 10px; border-radius:6px; cursor:pointer;">Exit Game</button>
    <div id="gameStage"></div>
  </div>
</div>
<style>
  .game-btn { background:#22d3ee; color:#0f172a; border:none; padding:10px 20px; border-radius:8px; font-weight:bold; cursor:pointer; margin-top:10px; }
  .game-score { font-size:24px; font-weight:bold; color:#4ade80; margin:10px 0; }
  .bomb-anim { font-size:80px; animation: pulseBomb 1s infinite; display:inline-block; }
  @keyframes pulseBomb { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
  .exploded { font-size:100px; animation: explode 0.5s forwards; }
  @keyframes explode { 0% { transform: scale(1); opacity:1; } 100% { transform: scale(2); opacity:0; } }
  .puzzle-piece { background:#1e293b; padding:10px; margin:5px; border:1px solid #334155; border-radius:6px; cursor:pointer; }
  .puzzle-piece:hover { border-color:#22d3ee; }
  .match-card { background:#1e293b; padding:15px; margin:5px; border-radius:8px; cursor:pointer; text-align:center; border:1px solid #334155; }
  .match-selected { border-color:#22d3ee; background:#334155; }
  .match-correct { border-color:#4ade80; background:rgba(74, 222, 128, 0.1); }
  @keyframes pop-fade {
    0% { transform: scale(0.5) translateY(10px); opacity: 0; }
    50% { transform: scale(1.2) translateY(0); opacity: 1; }
    100% { transform: scale(1) translateY(-20px); opacity: 0; }
  }
  .emoji-pop {
    position: absolute; left:0; right:0; margin:auto;
    display: inline-block;
    animation: pop-fade 1s ease-out forwards;
  }
</style>
</div>

</div> <!-- END MAIN DASHBOARD -->

</div> <!-- END CONTAINER -->

<script>
// GLOBAL ELEMENTS - PROPERLY INITIALIZED
const login = document.getElementById('login');
const mainDashboard = document.getElementById('mainDashboard');
const chatBox = document.getElementById("chatBox");
const topics = document.getElementById("topics");
const timerEl = document.getElementById("timer");
const micBtn = document.getElementById("micBtn");
let downloadLog = []; // Store history
let resumeUploadLog = []; // Store uploaded resumes

// ------------------------- IMAGE & RESUME -------------------------
// FIXED: uploadResume now ONLY shows dashboard, ensures communication stays hidden
function showLogin(){ 
  hideAllSections();
  login.classList.remove("hidden"); 
  login.scrollIntoView({ behavior: 'smooth', block: 'center' });
}

function goUpload(){ 
  const email = document.getElementById('loginEmail').value.trim();
  if(!email) { alert("Please enter an email address."); return; }

  const initial = email.charAt(0).toUpperCase();
  document.getElementById('profileIcon').innerText = initial;
  
  // Pre-fill Profile Email
  document.getElementById('pEmail').value = email;

  hideAllSections();
  document.getElementById('homePage').classList.remove('hidden');
  document.getElementById('loginBtn').style.display = 'none';
  document.getElementById('profileSection').style.display = 'block';
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

function uploadResume(input){ 
  if(input.files && input.files[0]){ 
    const file = input.files[0];
    const fileUrl = URL.createObjectURL(file);
    document.getElementById('resumeName').innerHTML = "Uploaded: " + file.name + ` <button onclick="window.open('${fileUrl}', '_blank')" style="background:none; border:none; cursor:pointer; font-size:18px; color:#22d3ee; vertical-align:middle;" title="View Resume">ü§ñ</button>`;
    hideAllSections(); // Hide EVERYTHING first
    showPanel('resume'); // Show Dashboard and Resume Panel
    const score = Math.floor(Math.random()*30) + 65; 
    drawPie(score); 
    document.getElementById('scoreText').innerText = score + "% Overall Score"; 
    
    // Add to History
    const date = new Date().toLocaleDateString() + " " + new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
    resumeUploadLog.push({ date, name: file.name, score, url: fileUrl });
  } 
}

function hideAllSections() {
  document.getElementById('homePage').classList.add('hidden');
  login.classList.add('hidden');
  mainDashboard.classList.add('hidden');
}

function drawPie(score){ 
  const ctx = document.getElementById('pieChart').getContext("2d"); 
  ctx.clearRect(0,0,200,200); 
  let color = score>=90 ? "green" : score>=60 ? "blue" : "red"; 
  const angle = score/100*2*Math.PI; 
  ctx.beginPath(); 
  ctx.moveTo(100,100); 
  ctx.arc(100,100,80,0,angle); 
  ctx.fillStyle = color; 
  ctx.fill(); 
  ctx.beginPath(); 
  ctx.arc(100,100,80,angle,2*Math.PI); 
  ctx.fillStyle = "#1e293b"; 
  ctx.fill(); 
  ctx.fillStyle = "white"; 
  ctx.font = "20px Arial"; 
  ctx.fillText(score+"%",75,110); 
}

function show(id){ 
  document.querySelectorAll(".section").forEach(s => s.classList.add("hidden")); 
  document.getElementById(id).classList.remove("hidden");
  document.querySelector('.tabs').scrollIntoView({ behavior: 'smooth', block: 'start' });
}

function downloadReport(){ 
  const score = document.getElementById('scoreText').innerText || "N/A";
  const report = `AI RESUME ANALYZER REPORT
=========================

OVERALL SCORE: ${score}

1. CRITICAL IMPROVEMENTS
------------------------
- Action Verbs: Use words like Spearheaded, Engineered, Optimized.
- Metrics: Quantify results (e.g., "Reduced latency by 20%").
- Keywords: Add missing technical skills (Docker, CI/CD, REST API).

2. FORMATTING CHECKLIST
-----------------------
[ ] Use standard fonts (Arial, Calibri, Roboto)
[ ] No tables or graphics (ATS friendly)
[ ] Consistent date formatting (e.g., MM/YYYY)

Generated by AI Resume Analyzer & Job Matcher`;

  const blob = new Blob([report], {type: "text/plain"}); 
  const link = document.createElement("a"); 
  link.href = URL.createObjectURL(blob); 
  link.download = "AI_Resume_Report.txt"; 
  addToHistory("AI Resume Report");
  link.click(); 
}

function downloadForEditing(){
  if(resumeUploadLog.length === 0){
    alert("Please upload a resume first.");
    return;
  }

  const latestResume = resumeUploadLog[resumeUploadLog.length - 1];
  
  // Instead of downloading the original file (which might be a non-editable PDF),
  // this now provides a fully editable Word document based on a professional template.
  const content = getTemplateContent(0); // Using the first template as a base
  const htmlContent = `
    <html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:w='urn:schemas-microsoft-com:office:word' xmlns='http://www.w3.org/TR/REC-html40'>
    <head><title>Editable Resume</title></head>
    <body>
      <p><b>Instructions:</b> This is an editable template. Please replace the placeholder text below with the content from your resume. You can use the suggestions from the 'Improve' tab to guide your edits.</p>
      <br/>
      ${content}
    </body>
    </html>`;
    
  const blob = new Blob([htmlContent], { type: 'application/msword' });
  const link = document.createElement('a');
  link.href = URL.createObjectURL(blob);
  
  const originalName = latestResume.name.split('.').slice(0, -1).join('.') || latestResume.name;
  link.download = `${originalName}_editable.doc`;
  
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
  
  addToHistory(`Editable Template for ${latestResume.name}`);
}
// ------------------------- INTERVIEW CHATBOT -------------------------
const interviewData = {
  hr: [
    { q: "Tell me about yourself.", a: "I am a passionate professional with a background in [Field]. I have [Number] years of experience, specifically in [Key Skill]. I am looking for a role where I can apply my skills in [Area] to drive results." },
    { q: "Why do you want to join our company?", a: "I admire your company's commitment to [Value/Mission]. I have followed your recent work in [Project/Product] and I believe my skills in [Skill] would be a great asset to your team." },
    { q: "What are your greatest strengths?", a: "My greatest strength is my ability to [Skill], which helps me [Outcome]. For example, I recently [Achievement]." },
    { q: "Where do you see yourself in 5 years?", a: "I see myself growing into a [Senior Role], taking on more responsibilities, and contributing significantly to the company's strategic goals." }
  ],
  general: [
    { q: "Describe a difficult challenge you faced.", a: "In a previous project, I faced [Challenge]. I analyzed the situation, collaborated with my team to find a solution, and successfully [Outcome]." },
    { q: "How do you handle tight deadlines?", a: "I prioritize tasks based on impact and urgency. I communicate proactively with stakeholders and focus on delivering the core requirements first." },
    { q: "Do you prefer working alone or in a team?", a: "I appreciate both. I value the focus of independent work but believe that teamwork brings diverse perspectives that lead to better solutions." },
    { q: "How do you handle criticism?", a: "I view criticism as constructive feedback. I listen actively, ask for specific examples, and use the input to improve my performance." }
  ],
  technical: {
    frontend: [
      { q: "Explain the Virtual DOM in React.", a: "The Virtual DOM is a lightweight copy of the real DOM. React uses it to identify changes (diffing) and efficiently update only the modified parts of the real DOM (reconciliation)." },
      { q: "What is the difference between var, let, and const?", a: "Var is function-scoped and hoisted. Let and Const are block-scoped. Const cannot be reassigned, while Let can. Const is preferred for immutable values." },
      { q: "Explain CSS Box Model.", a: "The Box Model consists of Content, Padding, Border, and Margin. It determines the layout and spacing of elements on a web page." },
      { q: "How do you optimize website performance?", a: "I use techniques like lazy loading, image optimization, code splitting, caching, and minimizing HTTP requests to improve load times." }
    ],
    backend: [
      { q: "What is the difference between SQL and NoSQL?", a: "SQL databases are relational with structured schemas (e.g., MySQL). NoSQL databases are non-relational and flexible (e.g., MongoDB), suitable for unstructured data." },
      { q: "Explain RESTful API architecture.", a: "REST is an architectural style using HTTP methods (GET, POST, PUT, DELETE). It relies on stateless communication and standard status codes." },
      { q: "How does Node.js handle concurrency?", a: "Node.js uses a single-threaded event loop and non-blocking I/O to handle multiple concurrent connections efficiently without creating new threads for each request." },
      { q: "What is middleware?", a: "Middleware functions have access to the request and response objects. They can execute code, modify data, or terminate the request-response cycle (e.g., authentication)." }
    ],
    fullstack: [
      { q: "Explain MVC architecture.", a: "MVC separates an application into Model (data), View (UI), and Controller (logic). This separation of concerns improves maintainability and scalability." },
      { q: "How do you handle CORS issues?", a: "CORS restricts cross-origin requests. I handle it by configuring the backend to send the appropriate 'Access-Control-Allow-Origin' headers." },
      { q: "What is CI/CD?", a: "CI/CD stands for Continuous Integration and Continuous Deployment. It automates testing and deployment to ensure frequent and reliable software releases." },
      { q: "How do you secure a web application?", a: "I implement HTTPS, input validation, authentication (JWT), authorization, and protection against common attacks like SQL Injection and XSS." }
    ],
    dataAnalyst: [
      { q: "Explain the difference between INNER JOIN and LEFT JOIN.", a: "INNER JOIN returns only matching rows from both tables. LEFT JOIN returns all rows from the left table and matching rows from the right (or NULL)." },
      { q: "How do you handle missing data in a dataset?", a: "I analyze the cause. Strategies include dropping rows, imputing with mean/median, or using algorithms that support missing values." },
      { q: "What is the difference between supervised and unsupervised learning?", a: "Supervised learning uses labeled data to predict outcomes (e.g., regression). Unsupervised learning finds patterns in unlabeled data (e.g., clustering)." },
      { q: "Explain the Central Limit Theorem.", a: "CLT states that the sampling distribution of the sample mean approaches a normal distribution as the sample size increases, regardless of the population distribution." }
    ],
    aiEngineer: [
      { q: "What is overfitting and how can you prevent it?", a: "Overfitting occurs when a model learns noise. Prevention includes regularization (L1/L2), dropout, early stopping, and increasing the dataset size." },
      { q: "Explain the difference between precision and recall.", a: "Precision is the accuracy of positive predictions. Recall is the ability to find all actual positives. There is often a trade-off between them." },
      { q: "How does a Convolutional Neural Network (CNN) work?", a: "CNNs use convolutional layers with filters to detect features (edges, textures) and pooling layers to reduce dimensionality, effective for image processing." },
      { q: "What are vanishing gradients?", a: "In deep networks, gradients can become too small during backpropagation, stopping learning. Solutions include ReLU activation and skip connections." }
    ]
  }
};

const roleKeywords = {
  frontend: ["react", "javascript", "css", "html", "component", "redux", "dom", "api", "hook"],
  backend: ["node", "sql", "database", "api", "server", "rest", "mongodb", "express", "auth"],
  fullstack: ["react", "node", "database", "api", "frontend", "backend", "deploy", "aws", "ci/cd"],
  dataAnalyst: ["sql", "python", "data", "analysis", "visualization", "statistics", "cleaning", "excel"],
  aiEngineer: ["model", "training", "python", "neural", "accuracy", "data", "algorithm", "tensor"],
  hr: ["team", "collaboration", "leadership", "communication", "goal", "challenge", "success", "learn"],
  general: ["situation", "task", "action", "result", "team", "deadline", "solution", "plan"]
};

let intQuestions = [];
let intIndex = 0;
let userAnswers = [];
let intTimerInterval;
let intSeconds = 0;

function endInterviewSession(){
  stopIntTimer();
  if('speechSynthesis' in window) window.speechSynthesis.cancel();
  stopIntMic();
  resetInterview();
}

function startInterviewBot(){
  const role = document.getElementById('intRole').value;
  const type = document.getElementById('intType').value;
  
  if(type === 'technical') {
    intQuestions = interviewData.technical[role];
  } else {
    intQuestions = interviewData[type];
  }
  
  intIndex = 0;
  userAnswers = [];
  document.getElementById('interviewSetup').classList.add('hidden');
  document.getElementById('interviewChatArea').classList.remove('hidden');
  document.getElementById('intChatBox').innerHTML = '';
  document.getElementById('intProgress').innerText = 'Question 1 of 5';
  
  const intro = `Hello! I am your AI Interviewer. We will conduct a ${type.toUpperCase()} interview for the ${role} role. Let's begin.`;
  addIntBotMsg(intro);
  speakInt(intro, () => {
    setTimeout(() => askIntQuestion(), 1000);
  });
}

function askIntQuestion(){
  if(intIndex < intQuestions.length){
    const qObj = intQuestions[intIndex];
    addIntBotMsg(`Q${intIndex+1}: ${qObj.q}`);
    speakInt(qObj.q);
    startIntTimer();
  } else {
    evaluateInterview();
  }
}

function sendIntMsg(){
  const input = document.getElementById('intUserInput');
  let text = input.value.trim();
  let analysisText = text;

  // If audio exists, use the hidden transcript for analysis
  if(intAudioUrl && intTranscript) {
    analysisText = intTranscript;
  }

  if(!text && !intAudioUrl) return;
  
  addIntUserMsg(text, intAudioUrl);
  intAudioUrl = null;
  intTranscript = "";
  stopIntTimer();
  input.value = '';
  document.getElementById('intLiveFeedback').classList.add('hidden');
  
  const currentQObj = intQuestions[intIndex];
  userAnswers.push({ question: currentQObj.q, answer: analysisText });
  
  // Provide Exact Reverse Answer (Model Answer)
  const feedback = "Here is a sample ideal answer: " + currentQObj.a;
  
  setTimeout(() => {
    addIntBotMsg("üí° " + feedback);
    speakInt(feedback, () => {
      intIndex++;
      if (intIndex >= 5) {
        document.getElementById('intProgress').innerText = 'Finished';
        endInterviewSession();
        evaluateInterview();
      } else {
        document.getElementById('intProgress').innerText = `Question ${intIndex + 1} of 5`;
        setTimeout(() => askIntQuestion(), 1500);
      }
    });
  }, 1000);
}

function startIntTimer(){
  clearInterval(intTimerInterval);
  intSeconds = 0;
  document.getElementById('intTimer').innerText = "00:00";
  intTimerInterval = setInterval(() => {
    intSeconds++;
    const m = Math.floor(intSeconds/60).toString().padStart(2,'0');
    const s = (intSeconds%60).toString().padStart(2,'0');
    document.getElementById('intTimer').innerText = `${m}:${s}`;
  }, 1000);
}

function stopIntTimer(){
  clearInterval(intTimerInterval);
}

function speakInt(text, callback){
  if('speechSynthesis' in window){
    window.speechSynthesis.cancel();
    const u = new SpeechSynthesisUtterance(text);
    u.lang = "en-US";
    if(callback) u.onend = callback;
    window.speechSynthesis.speak(u);
  } else {
    if(callback) callback();
  }
}

function addIntBotMsg(text){
  const div = document.createElement("div");
  div.className = "msg bot";
  div.innerText = text;
  const box = document.getElementById('intChatBox');
  box.appendChild(div);
  box.scrollTop = box.scrollHeight;
}

function addIntUserMsg(text, audioUrl){
  const div = document.createElement("div");
  div.className = "msg user";
  div.innerText = text;
  if(audioUrl){
    const audio = document.createElement("audio");
    audio.controls = true;
    audio.src = audioUrl;
    audio.style.marginTop = "5px";
    audio.style.maxWidth = "100%";
    div.appendChild(audio);
  }
  const box = document.getElementById('intChatBox');
  box.appendChild(div);
  box.scrollTop = box.scrollHeight;
}

let intRecognition;
let intMediaRecorder;
let intAudioChunks = [];
let intAudioUrl = null;
let intTranscript = "";
let recordingTimerInterval;

async function startIntMic(){
  const btn = document.getElementById('intMicBtn');
  const liveBox = document.getElementById('intLiveFeedback');
  
  if(btn.innerText.includes("üî¥") || (intRecognition && intRecognition.started)) {
    stopIntMic();
    return;
  }

  try {
    intTranscript = ""; // Reset transcript
    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
    intAudioChunks = [];
    intMediaRecorder = new MediaRecorder(stream);
    intMediaRecorder.ondataavailable = e => intAudioChunks.push(e.data);
    intMediaRecorder.onstop = () => {
      const blob = new Blob(intAudioChunks, { type: 'audio/webm' });
      intAudioUrl = URL.createObjectURL(blob);
      sendIntMsg();
    };
    intMediaRecorder.start();
  } catch(e) {
    alert("Microphone access required for recording.");
    return;
  }

  if('webkitSpeechRecognition' in window){
    window.speechSynthesis.cancel();
    intRecognition = new webkitSpeechRecognition();
    intRecognition.lang = "en-US";
    intRecognition.interimResults = true;
    intRecognition.continuous = true;
    intRecognition.started = true;

    intRecognition.onstart = () => {
      document.getElementById('intUserInput').placeholder = "Listening...";
      
      // Reset Live Feedback
      liveBox.classList.remove('hidden');
      document.getElementById('liveWordCount').innerText = "0 Words";
      document.getElementById('liveKeywords').innerHTML = "";
    };
    intRecognition.onend = () => {
      intRecognition.started = false;
    };

    intRecognition.onresult = function(event){
      let transcript = "";
      for (let i = event.resultIndex; i < event.results.length; ++i) {
        transcript += event.results[i][0].transcript;
      }
      intTranscript = transcript; // Store for analysis, don't show in input
      
      // Live Analysis Logic
      const words = transcript.trim().split(/\s+/).length;
      document.getElementById('liveWordCount').innerText = words + " Words";
      
      const role = document.getElementById('intRole').value;
      const type = document.getElementById('intType').value;
      const targetKeywords = (type === 'technical') ? roleKeywords[role] : roleKeywords[type];
      
      if(targetKeywords){
        const found = targetKeywords.filter(k => transcript.toLowerCase().includes(k));
        const kwContainer = document.getElementById('liveKeywords');
        kwContainer.innerHTML = found.map(k => `<span class="live-tag">‚úì ${k}</span>`).join('');
      }
    };
    intRecognition.start();
  } else {
    alert("Speech recognition not supported in this browser.");
    return;
  }

  btn.innerText = "üî¥ Stop Recording";
}

function stopIntMic(){
  clearInterval(recordingTimerInterval);
  const btn = document.getElementById('intMicBtn');
  if(btn) btn.innerText = "üé§ Microphone";
  document.getElementById('intUserInput').placeholder = "Type your answer...";

  if(intRecognition) {
    intRecognition.stop();
    intRecognition.started = false;
  }
  if(intMediaRecorder && intMediaRecorder.state !== 'inactive') {
    intMediaRecorder.stop();
  }
}

function evaluateInterview(){
  const role = document.getElementById('intRole').value;
  
  // Mock Scoring Logic (Simulating AI Analysis)
  const technical = Math.floor(Math.random() * 25) + 70; 
  const communication = Math.floor(Math.random() * 20) + 75;
  const confidence = Math.floor(Math.random() * 20) + 75;
  const overall = Math.floor((technical + communication + confidence) / 3);
  
  let recommendation = overall >= 80 ? "‚úÖ Ready for Interview" : "‚ö†Ô∏è Needs Practice";
  let recColor = overall >= 80 ? "#4ade80" : "#f87171";
  
  let advice = "";
  if(overall > 85) advice = "Excellent! You are well-prepared for this role.";
  else if(overall > 70) advice = "Good job! Focus on structuring your answers better.";
  else advice = "Needs improvement. Review technical concepts and practice speaking.";

  // Determine Strengths & Weaknesses
  const strengths = [];
  const weaknesses = [];
  if(technical >= 80) strengths.push("Strong Technical Knowledge");
  else if(technical < 60) weaknesses.push("Technical Concepts Gap");
  if(communication >= 80) strengths.push("Excellent Articulation");
  else if(communication < 60) weaknesses.push("Hesitant Communication");
  if(confidence >= 80) strengths.push("High Confidence");
  else if(confidence < 65) weaknesses.push("Low Confidence / Nervousness");
  if(strengths.length === 0) strengths.push("Balanced Profile");
  if(weaknesses.length === 0) weaknesses.push("No Major Weaknesses Detected");

  const suggestions = [
    "Use the STAR method (Situation, Task, Action, Result) for behavioral questions.",
    `Deepen your understanding of ${role} specific frameworks and tools.`,
    "Practice speaking clearly and confidently without long pauses."
  ];

  // Generate AI Answer Evaluation
  let answerEvaluations = "";
  userAnswers.forEach((item, i) => {
    const words = item.answer.split(" ").length;
    const clarity = words > 5 ? "Clear" : "Too Brief";
    const completeness = words > 15 ? "Good Depth" : "Lacks Detail";
    
    answerEvaluations += `
      <div style="margin-bottom:15px; border-bottom:1px solid #334155; padding-bottom:10px;">
        <p style="color:#cbd5f5; font-size:14px; margin:5px 0;"><b>Q${i+1}:</b> ${item.question}</p>
        <p style="color:#94a3b8; font-size:14px; font-style:italic; margin:5px 0;">"${item.answer}"</p>
        <div style="display:flex; gap:15px; font-size:12px; margin-top:5px;">
          <span style="color:${clarity==='Clear'?'#4ade80':'#f87171'}">Clarity: ${clarity}</span>
          <span style="color:${completeness==='Good Depth'?'#4ade80':'#facc15'}">Completeness: ${completeness}</span>
        </div>
        <p style="color:#22d3ee; font-size:13px; margin:5px 0;"><b>üí° AI Feedback:</b> ${words < 10 ? "Expand on your answer using the STAR method." : "Good use of keywords and structure."}</p>
      </div>`;
  });

  const reportHTML = `
    <div style="background:#1e293b; padding:20px; border-radius:10px; border:1px solid #22d3ee;">
      <h3 style="color:#22d3ee; margin-top:0; text-align:center;">Interview Performance Report</h3>
      
      <div style="text-align:center; margin-bottom:20px;">
        <span style="background:${recColor}; color:#0f172a; padding:5px 15px; border-radius:20px; font-weight:bold; font-size:14px;">${recommendation}</span>
      </div>

      <div style="display:flex; justify-content:space-around; margin:20px 0;">
        <div style="text-align:center;">
          <div style="font-size:24px; font-weight:bold; color:#4ade80;">${overall}%</div>
          <div style="font-size:12px; color:#cbd5f5;">Overall Score</div>
        </div>
        <div style="text-align:center;">
          <div style="font-size:24px; font-weight:bold; color:#facc15;">${technical}%</div>
          <div style="font-size:12px; color:#cbd5f5;">Technical Accuracy</div>
        </div>
        <div style="text-align:center;">
          <div style="font-size:24px; font-weight:bold; color:#f472b6;">${communication}%</div>
          <div style="font-size:12px; color:#cbd5f5;">Communication</div>
        </div>
        <div style="text-align:center;">
          <div style="font-size:24px; font-weight:bold; color:#38bdf8;">${confidence}%</div>
          <div style="font-size:12px; color:#cbd5f5;">Confidence</div>
        </div>
      </div>

      <p><b>üí° Feedback:</b> ${advice}</p>
      
      <div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px; margin-bottom:20px;">
        <div style="background:#0f172a; padding:15px; border-radius:8px;">
          <h4 style="color:#4ade80; margin-top:0;">‚úÖ Strengths</h4>
          <ul style="padding-left:20px; color:#cbd5f5; margin:0;">${strengths.map(s=>`<li>${s}</li>`).join('')}</ul>
        </div>
        <div style="background:#0f172a; padding:15px; border-radius:8px;">
          <h4 style="color:#f87171; margin-top:0;">‚ùå Weaknesses</h4>
          <ul style="padding-left:20px; color:#cbd5f5; margin:0;">${weaknesses.map(w=>`<li>${w}</li>`).join('')}</ul>
        </div>
      </div>

      <p><b>üöÄ Suggestions for Improvement:</b></p>
      <ul style="padding-left:20px; color:#cbd5f5;">
        ${suggestions.map(s => `<li style="margin-bottom:5px;">${s}</li>`).join('')}
      </ul>

      <h4 style="color:#22d3ee; border-bottom:1px solid #334155; padding-bottom:5px; margin-top:20px;">üìù Detailed Answer Evaluation</h4>
      ${answerEvaluations}

      <button onclick="downloadIntReport()" style="margin-top:20px; background:#334155; color:white; width:100%; padding:10px; border:none; border-radius:8px; cursor:pointer; font-weight:bold; margin-bottom:10px;">üì• Download Report PDF</button>
      <button onclick="resetInterview()" style="margin-top:20px; background:#22d3ee; color:#0f172a; width:100%; padding:10px; border:none; border-radius:8px; cursor:pointer; font-weight:bold;">Start New Interview</button>
    </div>
  `;

  const reportContainer = document.getElementById('interviewReport');
  reportContainer.innerHTML = reportHTML;
  
  document.getElementById('interviewChatArea').classList.add('hidden');
  reportContainer.classList.remove('hidden');
  reportContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
}

function downloadIntReport(){
  const text = document.getElementById('interviewReport').innerText;
  const blob = new Blob([text], {type: "text/plain"});
  const link = document.createElement("a");
  link.href = URL.createObjectURL(blob);
  link.download = "Interview_Report.txt";
  addToHistory("Interview Report");
  link.click();
}

function resetInterview(){
  document.getElementById('interviewSetup').classList.remove('hidden');
  document.getElementById('interviewChatArea').classList.add('hidden');
  document.getElementById('interviewReport').classList.add('hidden');
  document.getElementById('intInputArea').classList.remove('hidden');
}

// ------------------------- COMMUNICATION CHECK -------------------------
let recognition, countdown, timeLeft = 60, finalText = "";
let commFillerCount = 0;

function selectCommTopic(topic){ 
  document.getElementById('commIntro').classList.add('hidden');
  document.getElementById('commActiveArea').classList.remove('hidden');
  document.getElementById('activeTopic').innerText = "Topic: " + topic;
  timeLeft = 60; 
  document.getElementById('commTimer').innerText = "01:00";
  document.getElementById('commLiveMetrics').classList.remove('hidden');
  
  // Reset Metrics
  document.getElementById('livePace').innerText = "0 WPM";
  document.getElementById('paceBar').style.width = "0%";
  document.getElementById('liveFillers').innerText = "0";
  document.getElementById('commWordCloud').innerHTML = "";
  commFillerCount = 0;
  finalText = "";
}

if('webkitSpeechRecognition' in window){
  recognition = new webkitSpeechRecognition();
  recognition.lang = "en-US";
  recognition.continuous = true;
  recognition.interimResults = true;
  recognition.onresult = function(event){ 
    let interimTranscript = "";
    for(let i = event.resultIndex; i < event.results.length; i++){ 
      const transcript = event.results[i][0].transcript;
      if(event.results[i].isFinal) finalText += transcript + " ";
      else interimTranscript += transcript;
    } 
    
    // Live Analysis
    const fullText = finalText + interimTranscript;
    const words = fullText.trim().split(/\s+/);
    const wordCount = words.length;
    
    // Calculate WPM based on elapsed time
    const elapsed = 60 - timeLeft;
    const wpm = elapsed > 0 ? Math.round((wordCount / elapsed) * 60) : 0;
    document.getElementById('livePace').innerText = wpm + " WPM";
    document.getElementById('paceBar').style.width = Math.min(100, (wpm/150)*100) + "%";
    
    // Filler Detection
    const fillers = (fullText.match(/\b(um|uh|like|you know|sort of)\b/gi) || []).length;
    commFillerCount = fillers;
    document.getElementById('liveFillers').innerText = fillers;
    
    // Word Cloud (Last 5 strong words)
    const strongWords = words.filter(w => w.length > 6);
    const cloud = document.getElementById('commWordCloud');
    if(strongWords.length > 0){
      const lastWord = strongWords[strongWords.length-1];
      // Avoid duplicates in display for animation effect
      if(!cloud.lastChild || cloud.lastChild.innerText !== lastWord){
        const span = document.createElement('span');
        span.className = 'word-tag';
        span.innerText = lastWord;
        cloud.appendChild(span);
        if(cloud.children.length > 8) cloud.removeChild(cloud.firstChild);
      }
    }
  }
}

function startMic(){ 
  finalText = ""; 
  recognition.start(); 
  document.getElementById('commMicBtn').classList.add('hidden');
  document.getElementById('commStopBtn').classList.remove('hidden');
  document.getElementById('commInstructions').innerText = "üî¥ Recording... Speak clearly!";
  
  countdown = setInterval(() => { 
    timeLeft--; 
    let min = Math.floor(timeLeft/60); 
    let sec = timeLeft%60; 
    document.getElementById('commTimer').innerText = (min<10 ? "0"+min : min) + ":" + (sec<10 ? "0"+sec : sec); 
    if(timeLeft <= 0){ 
      stopCommTest();
    } 
  }, 1000); 
}

function stopCommTest(){
  clearInterval(countdown);
  recognition.stop();
  document.getElementById('commStopBtn').classList.add('hidden');
  document.getElementById('commInstructions').innerText = "Analyzing speech...";
  setTimeout(evaluateCommunication, 1500);
}

function evaluateCommunication(){
  let words = finalText.trim().split(" ").length;
  let fluency = Math.min(100, words);
  let accuracy = Math.floor(Math.random()*30) + 70;
  // Penalize fillers
  let communication = Math.max(0, Math.floor(Math.random()*20) + 80 - (commFillerCount * 2));
  let score = Math.floor((fluency*0.3 + accuracy*0.3 + communication*0.4));
  
  let feedback = "";
  if(score >= 85) feedback = "Excellent! You communicated clearly and confidently. Keep it up!";
  else if(score >= 70) feedback = "Good! Try to add more examples and speak smoothly.";
  else feedback = "Needs Improvement. Practice pronunciation, fluency, and clarity in your speech.";

  const reportHTML = `
    <div style="background:#1e293b; padding:20px; border-radius:10px; border:1px solid #22d3ee;">
      <h3 style="color:#22d3ee; margin-top:0; text-align:center;">Communication Skills Report</h3>
      
      <div style="display:flex; justify-content:space-around; margin:20px 0;">
        <div style="text-align:center;">
          <div style="font-size:24px; font-weight:bold; color:#4ade80;">${score}%</div>
          <div style="font-size:12px; color:#cbd5f5;">Overall Score</div>
        </div>
        <div style="text-align:center;">
          <div style="font-size:24px; font-weight:bold; color:#facc15;">${fluency}%</div>
          <div style="font-size:12px; color:#cbd5f5;">Word Volume</div>
        </div>
        <div style="text-align:center;">
          <div style="font-size:24px; font-weight:bold; color:#f472b6;">${accuracy}%</div>
          <div style="font-size:12px; color:#cbd5f5;">Clarity</div>
        </div>
      </div>

      <p><b>üí° Feedback:</b> ${feedback}</p>
      <p><b>üìù Transcript Analysis:</b> You spoke approximately ${words} words with ${commFillerCount} filler words detected.</p>
      
      <button onclick="resetCommTest()" style="margin-top:20px; background:#22d3ee; color:#0f172a; width:100%; padding:10px; border:none; border-radius:8px; cursor:pointer; font-weight:bold;">Start New Test</button>
    </div>
  `;

  const reportContainer = document.getElementById('commReport');
  reportContainer.innerHTML = reportHTML;
  
  document.getElementById('commChatArea').classList.add('hidden');
  reportContainer.classList.remove('hidden');
  reportContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
}

function resetCommTest(){
  document.getElementById('commReport').classList.add('hidden');
  document.getElementById('commChatArea').classList.remove('hidden');
  document.getElementById('commIntro').classList.remove('hidden');
  document.getElementById('commActiveArea').classList.add('hidden');
  document.getElementById('commLiveMetrics').classList.add('hidden');
  document.getElementById('commMicBtn').classList.remove('hidden');
  document.getElementById('commStopBtn').classList.add('hidden');
}

function showHome(){
  hideAllSections();
  document.getElementById('homePage').classList.remove('hidden');
}

// DASHBOARD NAVIGATION
function showPanel(panelId){
  hideAllSections();
  mainDashboard.classList.remove('hidden');
  
  // Hide all panels
  document.getElementById('resumePanel').classList.add('hidden');
  document.getElementById('analyzePanel').classList.add('hidden');
  document.getElementById('interviewPanel').classList.add('hidden');
  document.getElementById('communicationPanel').classList.add('hidden');
  document.getElementById('certificatePanel').classList.add('hidden');
  document.getElementById('videoSimPanel').classList.add('hidden');
  document.getElementById('templatesPanel').classList.add('hidden');
  document.getElementById('coverLetterPanel').classList.add('hidden');
  document.getElementById('salaryPanel').classList.add('hidden');
  document.getElementById('discoveryPanel').classList.add('hidden');
  document.getElementById('historyPanel').classList.add('hidden');
  document.getElementById('profilePanel').classList.add('hidden');
  document.getElementById('gamesPanel').classList.add('hidden');
  
  // Show target panel
  const panel = document.getElementById(panelId + 'Panel');
  panel.classList.remove('hidden');

  if(panelId === 'communication') {
    resetCommTest();
  }
  if(panelId === 'templates'){
    loadTemplates();
  }
  if(panelId === 'history'){
    renderHistory();
  }
  panel.scrollIntoView({ behavior: 'smooth', block: 'start' });
  document.getElementById('mainMenu').style.display = 'none'; // Close menu
}

function toggleProfileMenu(){
  const menu = document.getElementById('profileMenu');
  menu.style.display = (menu.style.display === 'flex') ? 'none' : 'flex';
}

function toggleMainMenu(){
  const menu = document.getElementById('mainMenu');
  menu.style.display = (menu.style.display === 'flex') ? 'none' : 'flex';
}

function logout(){
  hideAllSections();
  showHome();
  document.getElementById('loginBtn').style.display = 'inline-block';
  document.getElementById('profileSection').style.display = 'none';
  document.getElementById('profileMenu').style.display = 'none';
}

// JD MATCHING LOGIC
function handleJDUpload(input){
  if(input.files && input.files[0]){
    const reader = new FileReader();
    reader.onload = function(e){
      document.getElementById('jdInput').value = e.target.result;
    };
    reader.readAsText(input.files[0]);
  }
}

function analyzeJD(){
  const jdText = document.getElementById('jdInput').value.trim();
  if(!jdText) { alert("Please paste a Job Description or upload a file."); return; }

  // Mock Analysis
  const score = Math.floor(Math.random() * 30) + 60;
  document.getElementById('jdScore').innerText = score + "%";
  
  // Mock Data Generation
  const missing = ["Docker", "AWS", "GraphQL"];
  const edits = [
    "Add 'Docker' to Skills section.",
    "Mention 'AWS' experience in Project 2.",
    "Quantify impact in 'Senior Dev' role."
  ];
  
  const tableData = [
    { cat: "Skills", req: "React, Node.js, AWS", res: "React, Node.js", status: "‚ö†Ô∏è Partial" },
    { cat: "Experience", req: "3+ Years", res: "2 Years", status: "‚ùå Mismatch" },
    { cat: "Education", req: "B.S. Computer Science", res: "B.S. Computer Science", status: "‚úÖ Match" },
    { cat: "Tools", req: "Jira, Git, Docker", res: "Git, Jira", status: "‚ö†Ô∏è Partial" }
  ];

  // Populate UI
  const missingList = document.getElementById('jdMissing');
  missingList.innerHTML = "";
  missing.forEach(m => {
    const li = document.createElement("li");
    li.innerText = m;
    missingList.appendChild(li);
  });

  const editsList = document.getElementById('jdEdits');
  editsList.innerHTML = "";
  edits.forEach(e => {
    const li = document.createElement("li");
    li.innerText = e;
    editsList.appendChild(li);
  });

  const tbody = document.getElementById('jdTableBody');
  tbody.innerHTML = tableData.map(row => `
    <tr>
      <td>${row.cat}</td>
      <td>${row.req}</td>
      <td>${row.res}</td>
      <td style="color:${row.status.includes('Match')?'#4ade80':row.status.includes('Partial')?'#facc15':'#f87171'}">${row.status}</td>
    </tr>
  `).join('');

  document.getElementById('jdResults').classList.remove('hidden');
  document.getElementById('jdResults').scrollIntoView({ behavior: 'smooth', block: 'start' });
}

// CERTIFICATE SCANNER LOGIC
function handleCertUpload(input){
  if(input.files && input.files[0]){
    document.getElementById('certFileName').innerText = "Selected: " + input.files[0].name;
    const file = input.files[0];
    const fileUrl = URL.createObjectURL(file);
    document.getElementById('certFileName').innerHTML = "Selected: " + file.name + ` <button onclick="event.stopPropagation(); window.open('${fileUrl}', '_blank')" style="background:none; border:none; cursor:pointer; font-size:18px; color:#22d3ee; vertical-align:middle; margin-left:8px;" title="View Certificate">üëÅÔ∏è</button>`;
  }
}

function analyzeCertificate(){
  const input = document.getElementById('certInput');
  const courseName = document.getElementById('certNameInput').value.trim();

  if(!input.files || !input.files[0]) { alert("Please upload a certificate first."); return; }
  
  const fileName = input.files[0].name;
  // Mock analysis based on filename keywords
  let skill = courseName || "Professional Skills";
  
  if (!courseName) {
    if(fileName.toLowerCase().includes("react")) skill = "React Development";
    else if(fileName.toLowerCase().includes("python")) skill = "Python Programming";
    else if(fileName.toLowerCase().includes("aws")) skill = "Cloud Computing (AWS)";
    else if(fileName.toLowerCase().includes("data")) skill = "Data Analysis";
    else if(fileName.toLowerCase().includes("java")) skill = "Java Development";
  }
  
  const sentences = [
    `Earned a certification in ${skill}, demonstrating proficiency in core concepts and practical application through hands-on projects.`,
    `Successfully completed an intensive course on ${skill}, validating expertise in industry-standard tools and methodologies.`,
    `Certified in ${skill} by a recognized institution, strengthening technical capabilities and problem-solving skills.`
  ];
  
  const result = sentences[Math.floor(Math.random() * sentences.length)];
  
  const outputDiv = document.getElementById('certOutput');
  const resultDiv = document.getElementById('certResult');
  
  resultDiv.innerText = "Analyzing certificate content...";
  outputDiv.classList.remove('hidden');
  
  setTimeout(() => {
    resultDiv.innerText = result;
  }, 1500);
}

function copyCertText(){
  const text = document.getElementById('certResult').innerText;
  navigator.clipboard.writeText(text);
  alert("Copied to clipboard!");
}

// TEMPLATES LOGIC
const templateLinks = [
  "https://template.canva.com/EAGk_vgDNho/1/0/1131w-RMjjPYkgQyw.jpg",
  "https://template.canva.com/EAFlgmxCh-M/2/0/1131w-PFJ4Lzu3mSE.jpg",
  "https://template.canva.com/EAFryldyhkE/2/0/1131w-eQPgPsOtvnM.jpg",
  "https://template.canva.com/EAGYXzkWoD8/1/0/1131w-JLWiy-xdI3I.jpg",
  "https://template.canva.com/EAGXv5pYhwk/1/0/1131w--St4oysJXwY.jpg",
  "https://template.canva.com/EAGYXqVt6wg/1/0/1131w-dz7vGJ9RodA.jpg",
  "https://template.canva.com/EAGYXu9S_zg/1/0/1131w-W84S1DF7Bmo.jpg",
  "https://template.canva.com/EAGYX9B2K8A/1/0/1131w-oywWKG2URwU.jpg",
  "https://template.canva.com/EAGYXhip3y4/1/0/1131w-7mydc5RgWts.jpg"
];

function loadTemplates() {
  const grid = document.getElementById('templatesGrid');
  if(grid.innerHTML.trim() !== "") return;

  for(let i=0; i<templateLinks.length; i++){
    const url = templateLinks[i];
    const div = document.createElement('div');
    div.style.background = "#020617";
    div.style.padding = "10px";
    div.style.borderRadius = "8px";
    div.style.border = "1px solid #334155";
    div.innerHTML = `
      <img src="${url}" style="width:100%; height:250px; object-fit:cover; border-radius:6px; margin-bottom:10px;">
      <div style="display:flex; gap:10px;">
        <button onclick="window.open('${url}', '_blank')" style="flex:1; background:#334155; border:none; padding:8px; border-radius:4px; cursor:pointer; font-weight:bold; color:white;">View Template</button>
        <button onclick="editInWord(${i})" style="flex:1; background:#22d3ee; border:none; padding:8px; border-radius:4px; cursor:pointer; font-weight:bold; color:#0f172a;">Download Word Template</button>
      </div>
    `;
    grid.appendChild(div);
  }
}

async function downloadTemplate(url){
  try {
    const response = await fetch(url);
    const blob = await response.blob();
    const blobUrl = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = blobUrl;
    a.download = "Resume_Template.jpg";
    document.body.appendChild(a);
    addToHistory("Resume Template");
    a.click();
    document.body.removeChild(a);
    window.URL.revokeObjectURL(blobUrl);
  } catch(e) {
    const a = document.createElement('a');
    a.href = url;
    a.download = "Resume_Template.jpg";
    a.target = "_blank";
    addToHistory("Resume Template");
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
  }
}

function editInWord(index){
  const content = getTemplateContent(index);
  const htmlContent = `
    <html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:w='urn:schemas-microsoft-com:office:word' xmlns='http://www.w3.org/TR/REC-html40'>
    <head><title>Resume Template</title></head>
    <body>${content}</body>
    </html>`;
  const blob = new Blob([htmlContent], { type: 'application/msword' });
  const link = document.createElement('a');
  link.href = URL.createObjectURL(blob);
  link.download = 'Resume_Template_Editable.doc';
  link.click();
  addToHistory("Resume Template (Word)");
}

function getTemplateContent(index) {
  const name = "YOUR NAME";
  const role = "TARGET JOB TITLE";
  const contact = "123 Your Street, City, State | email@example.com | (123) 456-7890 | linkedin.com/in/yourprofile";
  const summary = "Results-oriented professional with a strong background in [Industry]. Proven track record of [Key Achievement]. Skilled in [Skill 1], [Skill 2], and [Skill 3]. Dedicated to driving organizational success through strategic planning and effective execution.";
  
  // Style 1: Modern Blue (Table Layout for Word)
  const style1 = `
    <table style="width:100%; border-collapse:collapse; font-family:Calibri, sans-serif;">
      <tr>
        <td style="background:#22d3ee; padding:30px; color:#0f172a;">
          <h1 style="margin:0; font-size:36px; text-transform:uppercase; letter-spacing:2px;">${name}</h1>
          <p style="margin:10px 0 0 0; font-size:18px; font-weight:bold;">${role}</p>
        </td>
      </tr>
      <tr>
        <td style="padding:30px;">
          <p style="text-align:center; font-size:14px; border-bottom:1px solid #ccc; padding-bottom:15px; margin-bottom:25px;">${contact}</p>
          
          <h3 style="color:#22d3ee; text-transform:uppercase; border-bottom:2px solid #22d3ee; padding-bottom:5px; margin-top:0;">Professional Profile</h3>
          <p style="line-height:1.5; margin-bottom:20px;">${summary}</p>

          <h3 style="color:#22d3ee; text-transform:uppercase; border-bottom:2px solid #22d3ee; padding-bottom:5px; margin-top:25px;">Work Experience</h3>
          
          <div style="margin-bottom:20px;">
            <p style="font-size:16px; font-weight:bold; margin-bottom:2px; color:#0f172a;">Senior Job Title</p>
            <p style="font-size:14px; font-style:italic; margin-top:0; color:#555;">Company Name | Location | Jan 2020 - Present</p>
            <ul style="margin-top:5px; line-height:1.5;">
              <li>Spearheaded a cross-functional team to deliver [Project Name], resulting in a 20% increase in efficiency.</li>
              <li>Optimized workflows and implemented new strategies to reduce costs by 15%.</li>
              <li>Mentored junior team members and conducted performance reviews.</li>
            </ul>
          </div>

          <div style="margin-bottom:20px;">
            <p style="font-size:16px; font-weight:bold; margin-bottom:2px; color:#0f172a;">Junior Job Title</p>
            <p style="font-size:14px; font-style:italic; margin-top:0; color:#555;">Previous Company | Location | Jan 2018 - Dec 2019</p>
            <ul style="margin-top:5px; line-height:1.5;">
              <li>Assisted in the development of [Product/Service], ensuring high-quality standards were met.</li>
              <li>Collaborated with clients to gather requirements and provide technical support.</li>
            </ul>
          </div>

          <h3 style="color:#22d3ee; text-transform:uppercase; border-bottom:2px solid #22d3ee; padding-bottom:5px; margin-top:25px;">Education</h3>
          <p style="margin-bottom:5px;"><strong>Bachelor of Science in [Major]</strong></p>
          <p style="margin-top:0;">University Name, City | Graduated: 2018</p>

          <h3 style="color:#22d3ee; text-transform:uppercase; border-bottom:2px solid #22d3ee; padding-bottom:5px; margin-top:25px;">Key Skills</h3>
          <p style="line-height:1.6;">Project Management ‚Ä¢ Strategic Planning ‚Ä¢ Data Analysis ‚Ä¢ Team Leadership ‚Ä¢ Communication ‚Ä¢ Problem Solving</p>
          
          <h3 style="color:#22d3ee; text-transform:uppercase; border-bottom:2px solid #22d3ee; padding-bottom:5px; margin-top:25px;">Projects</h3>
          <p style="margin-bottom:5px;"><strong>Project Name</strong> | <em>Role</em></p>
          <ul style="margin-top:5px; line-height:1.5;">
             <li>Description of the project and your specific contribution.</li>
             <li>Technologies used: Tool A, Tool B, Tool C.</li>
          </ul>
          
          <h3 style="color:#22d3ee; text-transform:uppercase; border-bottom:2px solid #22d3ee; padding-bottom:5px; margin-top:25px;">Certifications</h3>
          <ul style="margin-top:5px; line-height:1.5;">
             <li>Certified Professional in [Field] - Issuing Organization (2022)</li>
             <li>Advanced Workshop on [Topic] - Institution (2021)</li>
          </ul>
        </td>
      </tr>
    </table>`;

  // Style 2: Sidebar Dark (Table Layout)
  const style2 = `
    <table style="width:100%; border-collapse:collapse; font-family:Arial, sans-serif;">
      <tr>
        <td style="width:30%; background:#1e293b; color:white; padding:20px; vertical-align:top;">
          <div style="text-align:center; margin-bottom:30px; margin-top:20px;">
            <div style="width:100px; height:100px; background:#cbd5f5; border-radius:50%; margin:0 auto; line-height:100px; color:#1e293b; font-weight:bold; font-size:14px;">PHOTO</div>
          </div>
          
          <h3 style="color:#22d3ee; border-bottom:1px solid #22d3ee; padding-bottom:10px; font-size:16px; margin-top:0;">CONTACT</h3>
          <p style="font-size:13px; line-height:1.8;">
            üìû (123) 456-7890<br>
            üìß email@example.com<br>
            üìç City, State, Zip<br>
            üîó linkedin.com/in/user
          </p>

          <h3 style="color:#22d3ee; border-bottom:1px solid #22d3ee; padding-bottom:10px; font-size:16px; margin-top:40px;">SKILLS</h3>
          <ul style="font-size:13px; padding-left:20px; line-height:1.8;">
            <li>Skill One</li>
            <li>Skill Two</li>
            <li>Skill Three</li>
            <li>Skill Four</li>
            <li>Skill Five</li>
          </ul>

          <h3 style="color:#22d3ee; border-bottom:1px solid #22d3ee; padding-bottom:10px; font-size:16px; margin-top:40px;">EDUCATION</h3>
          <p style="font-size:13px; margin-bottom:5px; font-weight:bold;">Degree Name</p>
          <p style="font-size:13px; color:#cbd5f5; margin-top:0;">University Name<br>2015 - 2019</p>
          
          <h3 style="color:#22d3ee; border-bottom:1px solid #22d3ee; padding-bottom:10px; font-size:16px; margin-top:40px;">LANGUAGES</h3>
          <p style="font-size:13px;">English (Native)<br>Spanish (Fluent)</p>
          
          <h3 style="color:#22d3ee; border-bottom:1px solid #22d3ee; padding-bottom:10px; font-size:16px; margin-top:40px;">CERTIFICATIONS</h3>
          <p style="font-size:13px;">AWS Certified Solutions Architect</p>
        </td>
        
        <td style="width:70%; padding:40px; vertical-align:top; color:#333; background:#ffffff;">
          <h1 style="margin:0; font-size:42px; color:#1e293b; text-transform:uppercase; line-height:1;">${name}</h1>
          <p style="font-size:20px; color:#22d3ee; letter-spacing:3px; margin-top:10px; font-weight:bold;">${role}</p>
          
          <hr style="border:0; border-top:2px solid #eee; margin:30px 0;">

          <h3 style="color:#1e293b; font-size:18px; text-transform:uppercase; letter-spacing:1px; border-bottom:1px solid #ccc; padding-bottom:5px;">Profile</h3>
          <p style="line-height:1.6; color:#555;">${summary}</p>

          <h3 style="color:#1e293b; font-size:18px; text-transform:uppercase; letter-spacing:1px; border-bottom:1px solid #ccc; padding-bottom:5px; margin-top:40px;">Work Experience</h3>
          
          <div style="margin-bottom:25px;">
            <h4 style="margin:0; font-size:18px; color:#0f172a;">Senior Job Position</h4>
            <p style="margin:5px 0; font-size:14px; color:#22d3ee; font-weight:bold;">Company Name | 2020 - Present</p>
            <ul style="margin-top:10px; line-height:1.6; color:#555;">
              <li>Led the migration of legacy systems to a modern microservices architecture, improving scalability.</li>
              <li>Mentored junior developers and conducted code reviews to ensure high-quality standards.</li>
              <li>Reduced deployment time by 40% using automated CI/CD pipelines.</li>
            </ul>
          </div>

          <div style="margin-bottom:25px;">
            <h4 style="margin:0; font-size:18px; color:#0f172a;">Junior Job Position</h4>
            <p style="margin:5px 0; font-size:14px; color:#22d3ee; font-weight:bold;">Previous Company | 2018 - 2020</p>
            <ul style="margin-top:10px; line-height:1.6; color:#555;">
              <li>Developed responsive websites for high-profile clients using HTML, CSS, and JavaScript.</li>
              <li>Collaborated with designers to implement pixel-perfect UIs.</li>
            </ul>
          </div>
          
          <h3 style="color:#1e293b; font-size:18px; text-transform:uppercase; letter-spacing:1px; border-bottom:1px solid #ccc; padding-bottom:5px; margin-top:40px;">Projects</h3>
          <div style="margin-bottom:15px;">
             <h4 style="margin:0; font-size:16px; color:#0f172a;">E-Commerce Platform</h4>
             <p style="margin:5px 0; font-size:14px; color:#555;">Built a full-stack e-commerce application using MERN stack.</p>
          </div>
        </td>
      </tr>
    </table>`;

  // Style 3: Classic Minimalist
  const style3 = `
    <div style="font-family:'Times New Roman', serif; color:#000; max-width:800px; margin:0 auto;">
      <div style="text-align:center; border-bottom:2px solid #000; padding-bottom:20px; margin-bottom:30px;">
        <h1 style="margin:0; font-size:42px; letter-spacing:1px;">${name}</h1>
        <p style="margin:10px 0; font-size:14px;">${contact}</p>
      </div>

      <h3 style="text-transform:uppercase; font-size:16px; border-bottom:1px solid #000; padding-bottom:5px; margin-top:0;">Professional Summary</h3>
      <p style="line-height:1.6; margin-bottom:20px;">${summary}</p>

      <h3 style="text-transform:uppercase; font-size:16px; border-bottom:1px solid #000; padding-bottom:5px; margin-top:30px;">Professional Experience</h3>
      
      <table style="width:100%; margin-bottom:5px; margin-top:15px;">
        <tr>
          <td style="font-weight:bold; font-size:18px;">Project Manager</td>
          <td style="text-align:right; font-style:italic; font-size:16px;">Jan 2021 - Present</td>
        </tr>
        <tr>
          <td colspan="2" style="font-size:16px;">Global Corp, New York, NY</td>
        </tr>
      </table>
      <ul style="margin-top:5px; line-height:1.6; margin-bottom:20px;">
        <li>Managed a portfolio of projects valued at over $2M, delivering all on time and under budget.</li>
        <li>Coordinated with stakeholders to ensure timely delivery and alignment with business goals.</li>
        <li>Implemented Agile methodologies to improve team productivity by 25%.</li>
      </ul>

      <table style="width:100%; margin-bottom:5px; margin-top:15px;">
        <tr>
          <td style="font-weight:bold; font-size:18px;">Business Analyst</td>
          <td style="text-align:right; font-style:italic; font-size:16px;">Jun 2018 - Dec 2020</td>
        </tr>
        <tr>
          <td colspan="2" style="font-size:16px;">Finance Ltd, Chicago, IL</td>
        </tr>
      </table>
      <ul style="margin-top:5px; line-height:1.6; margin-bottom:20px;">
        <li>Analyzed business processes and identified areas for improvement.</li>
        <li>Created detailed reports and dashboards for executive leadership.</li>
      </ul>

      <h3 style="text-transform:uppercase; font-size:16px; border-bottom:1px solid #000; padding-bottom:5px; margin-top:30px;">Education</h3>
      <p style="margin-bottom:5px;"><strong>Master of Business Administration</strong>, Top Business School, 2018</p>
      <p style="margin-top:0;"><strong>Bachelor of Arts in Economics</strong>, State University, 2016</p>

      <h3 style="text-transform:uppercase; font-size:16px; border-bottom:1px solid #000; padding-bottom:5px; margin-top:30px;">Skills</h3>
      <p style="line-height:1.6;">Data Analysis ‚Ä¢ Financial Modeling ‚Ä¢ Agile Methodology ‚Ä¢ SQL ‚Ä¢ Tableau ‚Ä¢ Leadership ‚Ä¢ Public Speaking</p>
      
      <h3 style="text-transform:uppercase; font-size:16px; border-bottom:1px solid #000; padding-bottom:5px; margin-top:30px;">Projects</h3>
      <p style="margin-bottom:5px;"><strong>Market Research Initiative</strong></p>
      <ul style="margin-top:5px; line-height:1.6;">
        <li>Led a team of 5 to conduct comprehensive market research for a new product launch.</li>
      </ul>
    </div>`;

  if (index % 3 === 0) return style1;
  if (index % 3 === 1) return style2;
  return style3;
}

// VIDEO SIMULATOR LOGIC
let videoStream;
let liveAnalysisInterval;

function showMicroTip(message) {
  const container = document.getElementById('microTipsContainer');
  if (!container) return;

  const tip = document.createElement('div');
  tip.className = 'micro-tip';
  tip.innerText = `üí° ${message}`;
  
  // Randomize horizontal position slightly to avoid overlap
  const randomLeft = Math.floor(Math.random() * 40) + 30; // 30% to 70%
  tip.style.left = `${randomLeft}%`;

  container.appendChild(tip);

  setTimeout(() => {
    tip.remove();
  }, 4000); // Must match animation duration
}
function startVideo(){
  if(navigator.mediaDevices && navigator.mediaDevices.getUserMedia){
    navigator.mediaDevices.getUserMedia({ video: true, audio: true }).then(stream => {
      videoStream = stream;
      const video = document.getElementById('videoFeed');
      video.srcObject = stream;
      
      // Use onloadedmetadata to ensure video dimensions are available before playing
      video.onloadedmetadata = () => {
        video.play();
      };

      // UI Changes
      document.getElementById('videoPlaceholder').classList.add('hidden');
      document.getElementById('videoFeed').classList.remove('hidden');
      
      const container = document.getElementById('videoContainer');
      container.style.border = "2px solid transparent";
      container.style.background = "#000";
      
      document.getElementById('startVideoBtn').classList.add('hidden');
      document.getElementById('stopVideoBtn').classList.remove('hidden');
      document.getElementById('videoReport').classList.add('hidden');
      
      // Start Audio Visualizer
      document.getElementById('waveAnim').classList.remove('hidden');
      document.getElementById('waveText').classList.add('hidden');

      // Start Live Analysis Simulation
      liveAnalysisInterval = setInterval(() => {
        const confidence = Math.floor(Math.random() * 40) + 60; // 60-100
        const clarity = Math.floor(Math.random() * 30) + 70; // 70-100
        
        // Update metrics
        document.getElementById('liveConfidenceBar').style.width = confidence + '%';
        document.getElementById('liveClarityBar').style.width = clarity + '%';
        
        const sentimentEl = document.getElementById('liveSentiment');
        const videoContainer = document.getElementById('videoContainer');
        videoContainer.classList.remove('glow-red', 'glow-yellow', 'glow-green');

        if (confidence > 85 && clarity > 85) {
            sentimentEl.innerText = 'CONFIDENT';
            sentimentEl.style.background = '#4ade80';
            sentimentEl.style.color = '#0f172a';
            videoContainer.classList.add('glow-green');
        } else if (confidence > 70 && clarity > 75) {
            sentimentEl.innerText = 'NEUTRAL';
            sentimentEl.style.background = '#facc15';
            sentimentEl.style.color = '#0f172a';
            videoContainer.classList.add('glow-yellow');
        } else {
            sentimentEl.innerText = 'NERVOUS';
            sentimentEl.style.background = '#f87171';
            sentimentEl.style.color = 'white';
            videoContainer.classList.add('glow-red');
        }

        // --- Micro-tips Logic ---
        const tipChance = Math.random();
        if (tipChance < 0.35) { // 35% chance to show a tip every 2 seconds
            const tips = [];
            if (confidence < 75) {
                tips.push("Maintain eye contact");
                tips.push("Speak with more conviction");
            } else {
                tips.push("Good confidence!");
            }

            if (clarity < 80) {
                tips.push("Slow down a bit");
                tips.push("Avoid filler words");
            }
            // Pick a random tip from the possible ones
            showMicroTip(tips[Math.floor(Math.random() * tips.length)]);
        }
      }, 2000);

    }).catch(err => alert("Camera/Microphone access denied or not available."));
  }
}
function stopVideo(){
  clearInterval(liveAnalysisInterval); // Stop the simulation

  if(videoStream){
    videoStream.getTracks().forEach(track => track.stop());
    document.getElementById('videoPlaceholder').classList.remove('hidden');
    document.getElementById('videoFeed').classList.add('hidden');
    
    const container = document.getElementById('videoContainer');
    container.style.border = "2px dashed #334155";
    container.style.background = "#0f172a";
    
    document.getElementById('startVideoBtn').classList.remove('hidden');
    document.getElementById('stopVideoBtn').classList.add('hidden');
    
    // Stop Audio Visualizer
    document.getElementById('waveAnim').classList.add('hidden');
    document.getElementById('waveText').classList.remove('hidden');

    // Reset glow
    document.getElementById('videoContainer').classList.remove('glow-red', 'glow-yellow', 'glow-green');

    // --- Generate Combined Report ---
    
    // Video Metrics
    const eyeContact = Math.floor(Math.random() * 20) + 75;
    const posture = Math.floor(Math.random() * 15) + 80;
    
    // Audio/Emotion Metrics
    const confidence = Math.floor(Math.random() * 30) + 60;
    const nervousness = Math.floor(Math.random() * 30) + 10;
    const hesitation = Math.floor(Math.random() * 20) + 10;
    const sentiment = confidence > 70 ? "Positive & Confident" : "Neutral / Anxious";
    const grammarScore = Math.floor(Math.random() * 20) + 75;
    const fillerCount = Math.floor(Math.random() * 8);
    const fillers = fillerCount > 0 ? "um, uh, like" : "None detected";
    const pronunciation = grammarScore > 85 ? "Clear & Distinct" : "Needs Enunciation";

    // Overall Score Calculation
    const overallScore = Math.floor((eyeContact + posture + confidence + grammarScore) / 4);

    document.getElementById('videoReport').innerHTML = `
      <div style="background:#1e293b; padding:20px; border-radius:10px; border:1px solid #22d3ee;">
        <h3 style="color:#22d3ee; margin-top:0; text-align:center;">Comprehensive Interview Analysis</h3>
        
        <div style="text-align:center; margin-bottom:20px;">
          <div style="font-size:48px; font-weight:bold; color:${overallScore > 75 ? '#4ade80' : '#facc15'};">${overallScore}%</div>
          <div style="font-size:14px; color:#cbd5f5;">Overall Performance Score</div>
        </div>

        <h4 style="color:#22d3ee; border-bottom:1px solid #334155; padding-bottom:5px;">üìπ Video Presence</h4>
        <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; text-align:center; margin-bottom:20px;">
          <div><div style="font-size:24px; color:#4ade80; font-weight:bold;">${eyeContact}%</div><div style="font-size:12px; color:#cbd5f5;">Eye Contact</div></div>
          <div><div style="font-size:24px; color:#facc15; font-weight:bold;">${posture}%</div><div style="font-size:12px; color:#cbd5f5;">Posture</div></div>
        </div>

        <h4 style="color:#22d3ee; border-bottom:1px solid #334155; padding-bottom:5px;">üéô Audio & Sentiment</h4>
        <div style="text-align:center; margin-bottom:15px;">
          <span style="background:${confidence>70?'#4ade80':'#facc15'}; color:#0f172a; padding:5px 10px; border-radius:15px; font-weight:bold;">${sentiment}</span>
        </div>
        
        <div style="margin-bottom:10px;">
          <label style="color:#cbd5f5; display:flex; justify-content:space-between;"><span>Confidence Level</span> <span>${confidence}%</span></label>
          <div class="progress"><div class="bar" style="width:${confidence}%; background:#4ade80; height:10px;"></div></div>
        </div>
        <div style="margin-bottom:10px;">
          <label style="color:#cbd5f5; display:flex; justify-content:space-between;"><span>Nervousness</span> <span>${nervousness}%</span></label>
          <div class="progress"><div class="bar" style="width:${nervousness}%; background:#f87171; height:10px;"></div></div>
        </div>
        
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-top:15px;">
          <div style="background:#0f172a; padding:10px; border-radius:8px;">
            <div style="font-size:12px; color:#cbd5f5;">Grammar</div>
            <div style="font-size:18px; font-weight:bold; color:#4ade80;">${grammarScore}%</div>
          </div>
          <div style="background:#0f172a; padding:10px; border-radius:8px;">
            <div style="font-size:12px; color:#cbd5f5;">Fillers</div>
            <div style="font-size:18px; font-weight:bold; color:#facc15;">${fillerCount}</div>
          </div>
        </div>
        
        <p style="color:#cbd5f5; font-size:14px; margin-top:10px;"><b>Pronunciation:</b> ${pronunciation}</p>
        <p style="color:#cbd5f5; font-size:14px;"><b>Detected Fillers:</b> ${fillers}</p>

        <div style="background:#0f172a; padding:15px; border-radius:8px; margin-top:20px; border-left:4px solid #22d3ee;">
          <p style="color:#cbd5f5; margin:0;"><b>üí° AI Feedback:</b> ${eyeContact > 80 ? "Great eye contact!" : "Try to look at the camera more."} ${fillerCount > 3 ? "Try pausing instead of using filler words." : "Your speaking flow is clear."}</p>
        </div>
      </div>
    `;
    document.getElementById('videoReport').classList.remove('hidden');
  }}

// --- NEW FEATURES LOGIC ---

function generateCoverLetter(){
  const job = document.getElementById('clJobTitle').value || "Software Engineer";
  const company = document.getElementById('clCompany').value || "the company";
  const manager = document.getElementById('clManager').value || "Hiring Manager";
  
  const letter = `Dear ${manager},

I am writing to express my strong interest in the ${job} position at ${company}. With my background in software development and my passion for innovative technology, I am confident in my ability to contribute effectively to your team.

In my previous roles, I have honed my skills in coding, problem-solving, and collaboration. I admire ${company}'s commitment to excellence and would be honored to bring my expertise to your projects.

Thank you for considering my application. I look forward to the possibility of discussing how my skills align with your needs.

Sincerely,
[Your Name]`;

  document.getElementById('clOutput').value = letter;
}

function copyToClipboard(id){
  const el = document.getElementById(id);
  el.select();
  navigator.clipboard.writeText(el.value);
  alert("Copied to clipboard!");
}

function estimateSalary(){
  const role = document.getElementById('salRole').value || "Developer";
  const exp = parseInt(document.getElementById('salExp').value) || 0;
  const loc = document.getElementById('salLoc').value || "Remote";
  const skills = document.getElementById('salSkills').value;
  
  // Mock Logic (INR)
  let base = 400000;
  if(role.toLowerCase().includes('senior') || role.toLowerCase().includes('lead')) base += 600000;
  if(role.toLowerCase().includes('manager')) base += 1000000;
  
  base += (exp * 200000);
  if(skills.length > 5) base += 100000;
  
  if(loc.toLowerCase().match(/bangalore|mumbai|delhi|hyderabad|pune|chennai|gurgaon|noida/)) base += 200000;
  
  const min = base;
  const max = base + 300000;
  
  document.getElementById('salRange').innerText = `‚Çπ${min.toLocaleString('en-IN')} - ‚Çπ${max.toLocaleString('en-IN')}`;
  document.getElementById('salDesc').innerText = `Based on market data for ${role} with ${exp} years experience in ${loc}.`;
  
  const factors = [
    `Experience: ${exp} years adds significant value.`,
    `Location: ${loc} rates applied.`,
    `Skills: Premium for ${skills ? 'specialized skills' : 'standard stack'}.`
  ];
  
  document.getElementById('salFactors').innerHTML = factors.map(f => `<li>${f}</li>`).join('');
  document.getElementById('salaryResult').classList.remove('hidden');
}

const discoveryData = {
  "Bangalore": [
    { name: "Swiggy", website: "https://www.swiggy.com", industry: "Food Tech", loc: "Koramangala", jobs: [{role: "SDE-I Frontend", exp: "1-3 Yrs"}, {role: "Product Analyst", exp: "2-4 Yrs"}] },
    { name: "Flipkart", website: "https://www.flipkartcareers.com", industry: "E-commerce", loc: "Bellandur", jobs: [{role: "Backend Lead", exp: "6+ Yrs"}, {role: "UI/UX Designer", exp: "3-5 Yrs"}] },
    { name: "Razorpay", website: "https://razorpay.com/jobs", industry: "FinTech", loc: "Koramangala", jobs: [{role: "DevOps Engineer", exp: "2-5 Yrs"}] },
    { name: "Infosys", website: "https://www.infosys.com/careers", industry: "IT Services", loc: "Electronics City", jobs: [{role: "System Engineer", exp: "0-2 Yrs"}, {role: "Java Developer", exp: "3-5 Yrs"}] },
    { name: "Myntra", website: "https://careers.myntra.com", industry: "Fashion Tech", loc: "Kudlu Gate", jobs: [{role: "Data Scientist", exp: "4-7 Yrs"}, {role: "Frontend Lead", exp: "6+ Yrs"}] },
    { name: "InMobi", website: "https://www.inmobi.com/company/careers", industry: "AdTech", loc: "Indiranagar", jobs: [{role: "SDE-II Backend", exp: "3-6 Yrs"}] }
  ],
  "Hyderabad": [
    { name: "Microsoft", website: "https://careers.microsoft.com", industry: "Technology", loc: "Gachibowli", jobs: [{role: "Software Engineer II", exp: "3-6 Yrs"}, {role: "Cloud Architect", exp: "8+ Yrs"}] },
    { name: "Google", website: "https://careers.google.com", industry: "Technology", loc: "Kondapur", jobs: [{role: "Site Reliability Eng", exp: "4-7 Yrs"}] },
    { name: "Amazon", website: "https://www.amazon.jobs", industry: "E-commerce", loc: "Gachibowli", jobs: [{role: "SDE-I", exp: "1-3 Yrs"}, {role: "Operations Manager", exp: "5+ Yrs"}] },
    { name: "Oracle", website: "https://www.oracle.com/corporate/careers", industry: "Enterprise SW", loc: "HITEC City", jobs: [{role: "Java Developer", exp: "2-5 Yrs"}] },
    { name: "Salesforce", website: "https://www.salesforce.com/company/careers", industry: "CRM", loc: "DivyaSree Orion", jobs: [{role: "MTS Software", exp: "3-6 Yrs"}] },
    { name: "Deloitte", website: "https://www2.deloitte.com/ui/en/careers/careers.html", industry: "Consulting", loc: "HITEC City", jobs: [{role: "Tech Consultant", exp: "2-4 Yrs"}] }
  ],
  "Pune": [
    { name: "Mastercard", website: "https://www.mastercard.us/en-us/vision/who-we-are/careers.html", industry: "FinTech", loc: "Yerwada", jobs: [{role: "Java Developer", exp: "3-5 Yrs"}, {role: "QA Automation", exp: "2-4 Yrs"}] },
    { name: "Bajaj Finserv", website: "https://www.bajajfinserv.in/careers", industry: "Finance", loc: "Viman Nagar", jobs: [{role: "Data Analyst", exp: "1-3 Yrs"}] },
    { name: "Barclays", website: "https://home.barclays/careers", industry: "Banking", loc: "Kharadi", jobs: [{role: "Full Stack Dev", exp: "4-7 Yrs"}] },
    { name: "Credit Suisse", website: "https://www.credit-suisse.com/careers", industry: "Banking", loc: "Yerwada", jobs: [{role: "Risk Analyst", exp: "2-5 Yrs"}] },
    { name: "Amdocs", website: "https://www.amdocs.com/careers", industry: "Telecom SW", loc: "Magarpatta", jobs: [{role: "C++ Developer", exp: "3-6 Yrs"}] },
    { name: "Veritas", website: "https://www.veritas.com/company/careers", industry: "Data Mgmt", loc: "Baner", jobs: [{role: "System Software Eng", exp: "2-5 Yrs"}] }
  ],
  "Mumbai": [
    { name: "Jio Platforms", website: "https://careers.jio.com", industry: "Telecom/Tech", loc: "Navi Mumbai", jobs: [{role: "Full Stack Dev", exp: "2-5 Yrs"}, {role: "Network Eng", exp: "3-6 Yrs"}] },
    { name: "TCS", website: "https://www.tcs.com/careers", industry: "IT Services", loc: "Andheri", jobs: [{role: "System Engineer", exp: "0-2 Yrs"}] },
    { name: "HDFC Bank", website: "https://www.hdfcbank.com/personal/about-us/careers", industry: "Banking", loc: "Lower Parel", jobs: [{role: "App Developer", exp: "2-4 Yrs"}] },
    { name: "Morgan Stanley", website: "https://www.morganstanley.com/people", industry: "Finance", loc: "Elphinstone", jobs: [{role: "Java Associate", exp: "3-6 Yrs"}] },
    { name: "BookMyShow", website: "https://in.bookmyshow.com/careers", industry: "Entertainment", loc: "Andheri", jobs: [{role: "Frontend Dev", exp: "2-5 Yrs"}] },
    { name: "Dream11", website: "https://about.dream11.com/careers", industry: "Sports Tech", loc: "BKC", jobs: [{role: "SDE-II", exp: "3-6 Yrs"}] }
  ],
  "Delhi": [
    { name: "Zomato", website: "https://www.zomato.com/careers", industry: "Food Tech", loc: "Gurgaon", jobs: [{role: "Android Developer", exp: "2-4 Yrs"}, {role: "Growth Manager", exp: "4-6 Yrs"}] },
    { name: "Paytm", website: "https://paytm.com/careers", industry: "FinTech", loc: "Noida", jobs: [{role: "Golang Developer", exp: "3-5 Yrs"}] },
    { name: "MakeMyTrip", website: "https://www.makemytrip.com/careers", industry: "Travel Tech", loc: "Gurgaon", jobs: [{role: "React Native Dev", exp: "3-5 Yrs"}] },
    { name: "Airtel", website: "https://www.airtel.in/careers", industry: "Telecom", loc: "Gurgaon", jobs: [{role: "Product Manager", exp: "5-8 Yrs"}] },
    { name: "PolicyBazaar", website: "https://www.policybazaar.com/careers", industry: "FinTech", loc: "Gurgaon", jobs: [{role: "Backend Dev", exp: "2-4 Yrs"}] },
    { name: "Snapdeal", website: "https://www.snapdeal.com/info/jobs", industry: "E-commerce", loc: "Gurgaon", jobs: [{role: "SDE-I", exp: "1-3 Yrs"}] }
  ],
  "Remote": [
    { name: "GitLab", website: "https://about.gitlab.com/jobs", industry: "DevOps", loc: "Global", jobs: [{role: "Senior Frontend", exp: "5+ Yrs"}, {role: "Technical Writer", exp: "3+ Yrs"}] },
    { name: "Automattic", website: "https://automattic.com/work-with-us", industry: "Web", loc: "Global", jobs: [{role: "PHP Developer", exp: "3-6 Yrs"}] },
    { name: "Zapier", website: "https://zapier.com/jobs", industry: "Automation", loc: "Global", jobs: [{role: "Python Engineer", exp: "4+ Yrs"}] },
    { name: "Doist", website: "https://doist.com/careers", industry: "Productivity", loc: "Global", jobs: [{role: "Android Dev", exp: "3-6 Yrs"}] },
    { name: "Buffer", website: "https://buffer.com/journey", industry: "Social Media", loc: "Global", jobs: [{role: "Full Stack", exp: "3-5 Yrs"}] },
    { name: "Toptal", website: "https://www.toptal.com/careers", industry: "Freelance", loc: "Global", jobs: [{role: "React Expert", exp: "5+ Yrs"}] }
  ]
};

function updateDiscovery(){
  const cityInput = document.getElementById('discLocation').value.trim();
  const container = document.getElementById('discoveryResults');
  
  if(!cityInput) {
    container.innerHTML = `<p style="text-align:center; color:#64748b; margin-top:50px;">Please enter a city name to view companies.</p>`;
    return;
  }

  // Case insensitive lookup
  const cityKey = Object.keys(discoveryData).find(k => k.toLowerCase() === cityInput.toLowerCase());

  if(!cityKey) {
     container.innerHTML = `<p style="text-align:center; color:#f87171; margin-top:50px;">No data found for "${cityInput}". Try Bangalore, Hyderabad, Pune, Mumbai, Delhi, or Remote.</p>`;
     return;
  }

  const companies = discoveryData[cityKey];
  container.innerHTML = `<div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap:20px;">` + 
    companies.map(c => `
      <div style="background:#020617; padding:20px; border-radius:12px; border:1px solid #334155; position:relative;">
        <div style="display:flex; justify-content:space-between; align-items:start;">
          <div>
            <h4 style="color:#22d3ee; margin:0 0 5px 0; font-size:18px;">${c.name}</h4>
            <p style="color:#94a3b8; font-size:13px; margin:0 0 15px 0;">üìç ${c.loc} ‚Ä¢ üè¢ ${c.industry}</p>
          </div>
          <a href="${c.website}" target="_blank" style="background:#334155; color:white; text-decoration:none; padding:6px 12px; border-radius:6px; font-size:12px; font-weight:bold; transition:0.2s;" onmouseover="this.style.background='#22d3ee';this.style.color='#0f172a'" onmouseout="this.style.background='#334155';this.style.color='white'">üåê Visit</a>
        </div>
        <div style="border-top:1px solid #1e293b; padding-top:10px;">
          <p style="color:#cbd5f5; font-size:12px; font-weight:bold; margin-bottom:10px;">OPEN ROLES:</p>
          ${c.jobs.map(j => `
            <div style="background:#1e293b; padding:8px; border-radius:6px; margin-bottom:8px; display:flex; justify-content:space-between; align-items:center;">
              <span style="color:white; font-size:13px;">${j.role}</span>
              <span style="background:#334155; color:#cbd5f5; font-size:11px; padding:2px 6px; border-radius:4px;">${j.exp}</span>
            </div>
          `).join('')}
        </div>
      </div>
    `).join('') + 
  `</div>`;
}

function addToHistory(item){
  const date = new Date().toLocaleDateString() + " " + new Date().toLocaleTimeString();
  downloadLog.unshift({ date, item, action: "Downloaded" });
}

function renderHistory(){
  // Render Downloads
  const tbody = document.getElementById('historyTableBody');
  if(downloadLog.length === 0){
    tbody.innerHTML = "<tr><td colspan='3' style='text-align:center; padding:20px;'>No downloads yet.</td></tr>";
  } else {
    tbody.innerHTML = downloadLog.map(row => `<tr><td>${row.date}</td><td>${row.item}</td><td style="color:#4ade80;">‚úî ${row.action}</td></tr>`).join('');
  }

  // Render Uploads
  const upBody = document.getElementById('uploadHistoryBody');
  if(resumeUploadLog.length === 0){
    upBody.innerHTML = "<tr><td colspan='4' style='text-align:center; padding:20px;'>No resumes uploaded yet.</td></tr>";
    document.getElementById('histLatestScore').innerText = "-";
    document.getElementById('histDiff').innerHTML = "";
  } else {
    // Reverse for table (newest first)
    upBody.innerHTML = [...resumeUploadLog].reverse().map(row => `<tr><td>${row.date}</td><td>${row.name}</td><td style="font-weight:bold; color:${row.score>=80?'#4ade80':row.score>=60?'#facc15':'#f87171'}">${row.score}%</td><td style="text-align:center;"><button onclick="window.open('${row.url}', '_blank')" style="background:none; border:none; cursor:pointer; font-size:18px; color:#22d3ee;" title="View Resume">ü§ñ</button></td></tr>`).join('');
    
    // Update Stats
    const current = resumeUploadLog[resumeUploadLog.length-1];
    document.getElementById('histLatestScore').innerText = current.score + "%";
    
    if(resumeUploadLog.length > 1){
      const prev = resumeUploadLog[resumeUploadLog.length-2];
      const diff = current.score - prev.score;
      const color = diff >= 0 ? "#4ade80" : "#f87171";
      const sign = diff >= 0 ? "‚ñ≤ +" : "‚ñº ";
      document.getElementById('histDiff').innerHTML = `<span style="color:${color}">${sign}${diff}%</span> vs previous`;
    } else {
      document.getElementById('histDiff').innerText = "First upload";
    }
    
    // Draw Chart
    setTimeout(drawHistoryChart, 100);
  }
}

function drawHistoryChart(){
  const canvas = document.getElementById('historyChart');
  if(!canvas) return;
  const ctx = canvas.getContext('2d');
  // Set actual canvas size to match display
  canvas.width = canvas.offsetWidth;
  canvas.height = 200;
  const width = canvas.width;
  const height = canvas.height;
  
  ctx.clearRect(0, 0, width, height);
  
  if(resumeUploadLog.length < 2) {
    ctx.fillStyle = "#94a3b8";
    ctx.font = "14px Segoe UI";
    ctx.fillText("Upload at least 2 resumes to see the progression graph.", 20, 100);
    return;
  }

  const padding = 40;
  const chartW = width - (padding * 2);
  const chartH = height - (padding * 2);
  
  // Draw Axes
  ctx.strokeStyle = "#334155";
  ctx.lineWidth = 2;
  ctx.beginPath();
  ctx.moveTo(padding, padding);
  ctx.lineTo(padding, height - padding); // Y Axis
  ctx.lineTo(width - padding, height - padding); // X Axis
  ctx.stroke();
  
  // Plot Points
  const maxScore = 100;
  const stepX = chartW / (resumeUploadLog.length - 1);
  
  // Draw Line
  ctx.beginPath();
  ctx.strokeStyle = "#22d3ee";
  ctx.lineWidth = 3;
  resumeUploadLog.forEach((log, i) => {
    const x = padding + (i * stepX);
    const y = height - padding - ((log.score / maxScore) * chartH);
    if(i === 0) ctx.moveTo(x, y);
    else ctx.lineTo(x, y);
  });
  ctx.stroke();
  
  // Draw Points & Labels
  resumeUploadLog.forEach((log, i) => {
    const x = padding + (i * stepX);
    const y = height - padding - ((log.score / maxScore) * chartH);
    
    // Dot
    ctx.fillStyle = "#0f172a";
    ctx.beginPath(); ctx.arc(x, y, 6, 0, Math.PI * 2); ctx.fill();
    ctx.fillStyle = "#22d3ee";
    ctx.beginPath(); ctx.arc(x, y, 4, 0, Math.PI * 2); ctx.fill();
    
    // Score Label
    ctx.fillStyle = "white";
    ctx.font = "bold 12px Segoe UI";
    ctx.fillText(log.score + "%", x - 10, y - 15);
    
    // Date Label (Show only if space permits)
    if(resumeUploadLog.length < 8 || i % 2 === 0) {
       ctx.fillStyle = "#94a3b8";
       ctx.font = "10px Segoe UI";
       const shortDate = log.date.split(' ')[0]; 
       ctx.fillText(shortDate, x - 20, height - padding + 15);
    }
  });
}

function toggleEdit(){
  const inputs = document.querySelectorAll('#profilePanel input, #profilePanel select');
  const saveBtn = document.getElementById('saveProfileBtn');
  let isEnabled = false;

  inputs.forEach(input => {
    input.disabled = !input.disabled;
    if(!input.disabled) isEnabled = true;
  });

  if(isEnabled){
    saveBtn.disabled = false;
    saveBtn.style.opacity = "1";
    saveBtn.style.cursor = "pointer";
  } else {
    saveBtn.disabled = true;
    saveBtn.style.opacity = "0.5";
    saveBtn.style.cursor = "not-allowed";
  }
}

let userProfile = {};

function saveProfile(){
  const name = document.getElementById('pName').value;
  const email = document.getElementById('pEmail').value;
  const roles = document.getElementById('pRoles').value;
  const skills = document.getElementById('pSkills').value;
  const p1 = document.getElementById('pNewPass').value;
  const p2 = document.getElementById('pConfirmPass').value;

  if(p1 || p2){
    if(p1 !== p2) { alert("Passwords do not match!"); return; }
  }

  userProfile = { name, email, roles, skills };
  alert("Profile Updated Successfully! Preferences saved.");

  // Personalization Logic
  if(roles) {
    document.getElementById('salRole').value = roles.split(',')[0];
    document.getElementById('clJobTitle').value = roles.split(',')[0];
  }
  if(skills) document.getElementById('salSkills').value = skills;
  
  // Re-lock profile
  toggleEdit();
  
  showHome();
}

// --- GAMES LOGIC ---
let userXP = 0;
let gameInterval;
let gameRecognition;

function updateXP(amount){
  userXP += amount;
  document.getElementById('gameXP').innerText = userXP;
  const rank = userXP > 500 ? "Expert" : userXP > 200 ? "Pro" : userXP > 100 ? "Intermediate" : "Novice";
  document.getElementById('gameRank').innerText = rank;
}

function launchGame(id){
  document.getElementById('gamesLobby').classList.add('hidden');
  document.getElementById('activeGameContainer').classList.remove('hidden');
  const stage = document.getElementById('gameStage');
  stage.innerHTML = "";
  
  if(id === 1) startFillSilence(stage);
  if(id === 2) startProjectPitch(stage);
  if(id === 6) startHRDrama(stage);
  if(id === 7) startClientChaos(stage);
}

function exitGame(){
  clearInterval(gameInterval);
  if(gameRecognition) gameRecognition.stop();
  document.getElementById('activeGameContainer').classList.add('hidden');
  document.getElementById('gamesLobby').classList.remove('hidden');
}

// Game 1: Fill the Silence
let fsIndex = 0;
let fsTotalScore = 0;
const fsQuestions = [
  "In a team conflict, the most important thing is...",
  "When a deadline is missed, I usually...",
  "My biggest weakness is actually...",
  "To stay motivated during repetitive tasks, I...",
  "Effective communication means..."
];

function startFillSilence(stage){
  fsIndex = 0;
  fsTotalScore = 0;
  stage.innerHTML = `<h3>üéô Fill the Silence</h3><p style="color:#cbd5f5;">Listen to the AI and finish the sentence. (5 Rounds)</p>
  <div id="fsGameArea" style="text-align:center; margin-top:20px;">
    <div id="fsProgress" style="color:#94a3b8; margin-bottom:10px;">Question 1/5</div>
    <div id="fsPrompt" style="font-size:20px; color:#22d3ee; margin:20px 0; font-style:italic; min-height:60px;">Press Start to begin...</div>
    <button id="fsBtn" class="game-btn" onclick="fsPlayRound()">‚ñ∂ Start Round 1</button>
    <div id="fsFeedback" style="margin-top:20px; min-height:50px;"></div>
  </div>`;
}

function fsPlayRound(){
  if(fsIndex >= 5) return;
  const btn = document.getElementById('fsBtn');
  btn.disabled = true;
  btn.style.opacity = "0.5";
  
  const p = fsQuestions[fsIndex];
  document.getElementById('fsPrompt').innerText = `"${p}"`;
  document.getElementById('fsFeedback').innerHTML = "";
  
  // Simulate AI speaking then listening
  const u = new SpeechSynthesisUtterance(p);
  window.speechSynthesis.speak(u);
  u.onend = () => {
    document.getElementById('fsFeedback').innerHTML = "<span style='color:#facc15'>Listening... Complete the sentence!</span>";
    setTimeout(() => {
      const score = Math.floor(Math.random()*40)+60;
      fsTotalScore += score;
      document.getElementById('fsFeedback').innerHTML = `<div class="game-score">+${score} Points</div><p style="color:#cbd5f5;">Good flow!</p>`;
      
      fsIndex++;
      if(fsIndex < 5){
        document.getElementById('fsProgress').innerText = `Question ${fsIndex + 1}/5`;
        btn.innerText = `‚ñ∂ Start Round ${fsIndex + 1}`;
        btn.disabled = false;
        btn.style.opacity = "1";
      } else {
        setTimeout(fsShowResults, 1500);
      }
    }, 3000);
  };
}

function fsShowResults(){
  const avg = Math.round(fsTotalScore / 5);
  let badge = "", color = "", msg = "";
  
  if(avg >= 90) { badge = "ü•á GOLD"; color = "#facc15"; msg = "Outstanding Communication!"; }
  else if(avg >= 75) { badge = "ü•à SILVER"; color = "#cbd5f5"; msg = "Great Job!"; }
  else if(avg >= 60) { badge = "ü•â BRONZE"; color = "#cd7f32"; msg = "Good Effort!"; }
  else { badge = "üéó Better Luck Next Time"; color = "#f87171"; msg = "Keep Practicing!"; }
  
  const stage = document.getElementById('gameStage');
  stage.innerHTML = `
    <div style="text-align:center; animation: popIn 0.5s ease;">
      <h3>Game Over!</h3>
      <div style="font-size:60px; margin:20px 0;">${badge.split(' ')[0]}</div>
      <h2 style="color:${color}; margin:0;">${badge}</h2>
      <p style="font-size:18px; color:#cbd5f5;">Average Score: <span style="color:white; font-weight:bold;">${avg}%</span></p>
      <p style="color:#94a3b8;">${msg}</p>
      <button class="game-btn" onclick="startFillSilence(document.getElementById('gameStage'))">üîÑ Play Again</button>
      <button class="game-btn" style="background:#334155; color:white;" onclick="exitGame()">Exit</button>
    </div>
  `;
  updateXP(avg);
}

// Game 6: HR Drama
const hrQuestionPool = [
  {
    title: "The Railway Dilemma",
    question: "There are 3 people on a railway track. You can save only one. Whom will you save and why?",
    options: [
      { text: "\"I cannot choose; I would freeze.\"", correct: false, feedback: "‚ùå Indecision is dangerous in leadership." },
      { text: "\"I would analyze who has the highest chance of survival and act immediately.\"", correct: true, feedback: "‚úÖ Pragmatic and decisive under pressure. (+50 XP)" },
      { text: "\"I would sacrifice myself.\"", correct: false, feedback: "‚ùå Noble, but the company needs you alive." }
    ]
  },
  {
    title: "The Unethical Friend",
    question: "Your best friend at work is making a serious mistake that could cost the company money. What will you do?",
    options: [
      { text: "\"Cover for them. Friendship comes first.\"", correct: false, feedback: "‚ùå Unethical. This puts you at risk too." },
      { text: "\"Talk to them privately to fix it. If they refuse, I must report it.\"", correct: true, feedback: "‚úÖ Balances loyalty with integrity. (+50 XP)" },
      { text: "\"Report them immediately to the boss.\"", correct: false, feedback: "‚ùå Too aggressive without trying to resolve it first." }
    ]
  },
  {
    title: "Unethical Manager",
    question: "You see your manager doing something unethical. What is your reaction?",
    options: [
      { text: "\"Ignore it. They are the boss.\"", correct: false, feedback: "‚ùå Complicity is not a defense." },
      { text: "\"Gather evidence and report it to HR or Compliance anonymously.\"", correct: true, feedback: "‚úÖ Professional and protective of the company. (+50 XP)" },
      { text: "\"Confront them publicly.\"", correct: false, feedback: "‚ùå Dangerous and unprofessional." }
    ]
  },
  {
    title: "Values vs Rules",
    question: "If company rules and your personal values conflict, what would you choose?",
    options: [
      { text: "\"I follow rules blindly.\"", correct: false, feedback: "‚ùå Lacks critical thinking." },
      { text: "\"I would discuss the conflict with leadership to find a resolution or recuse myself.\"", correct: true, feedback: "‚úÖ Mature and communicative. (+50 XP)" },
      { text: "\"I would just quit immediately.\"", correct: false, feedback: "‚ùå Impulsive." }
    ]
  },
  {
    title: "Lying for the Job",
    question: "Would you lie to save your job?",
    options: [
      { text: "\"Yes, survival is the most important thing.\"", correct: false, feedback: "‚ùå Integrity is non-negotiable." },
      { text: "\"No, my integrity is worth more than any single role.\"", correct: true, feedback: "‚úÖ The only right answer in HR's eyes. (+50 XP)" },
      { text: "\"Only if it's a small lie.\"", correct: false, feedback: "‚ùå Slippery slope." }
    ]
  },
  {
    title: "Conflicting Deadlines",
    question: "You have two urgent tasks: one from your manager, one from a client. Both due now.",
    options: [
      { text: "\"Do the manager's task first.\"", correct: false, feedback: "‚ùå Ignores the client impact." },
      { text: "\"Communicate with both, explain the bottleneck, and negotiate a priority.\"", correct: true, feedback: "‚úÖ Communication solves conflicts. (+50 XP)" },
      { text: "\"Try to do both and burn out.\"", correct: false, feedback: "‚ùå Unsustainable." }
    ]
  },
  {
    title: "Disagree and Commit",
    question: "Your team disagrees with your decision, but you strongly believe you‚Äôre right.",
    options: [
      { text: "\"Do it my way. I'm the leader.\"", correct: false, feedback: "‚ùå Dictatorial." },
      { text: "\"Present my data to persuade them, but if they still disagree, commit to the team's choice.\"", correct: true, feedback: "‚úÖ 'Disagree and commit' is a key leadership trait. (+50 XP)" },
      { text: "\"Let them do what they want so they don't hate me.\"", correct: false, feedback: "‚ùå Weak leadership." }
    ]
  },
  {
    title: "Hiring Dilemma",
    question: "Team Lead role: One member is underperforming but sincere. Another is skilled but arrogant. Who stays?",
    options: [
      { text: "\"Keep the skilled arrogant one. Results matter.\"", correct: false, feedback: "‚ùå Toxic culture killer." },
      { text: "\"Keep the sincere one. Skills can be taught, attitude cannot.\"", correct: true, feedback: "‚úÖ Cultural fit is crucial. (+50 XP)" },
      { text: "\"Fire both.\"", correct: false, feedback: "‚ùå Expensive and disruptive." }
    ]
  },
  {
    title: "Resilience Test",
    question: "If you fail today‚Äôs interview, what will you do tomorrow?",
    options: [
      { text: "\"I'll be depressed and give up.\"", correct: false, feedback: "‚ùå Low resilience." },
      { text: "\"I'll ask for feedback, learn from it, and apply for the next opportunity.\"", correct: true, feedback: "‚úÖ Growth mindset! (+50 XP)" },
      { text: "\"I won't fail.\"", correct: false, feedback: "‚ùå Overconfidence can be a blinder." }
    ]
  },
  {
    title: "Ambiguity",
    question: "You are given a task with unclear requirements and a strict deadline.",
    options: [
      { text: "\"Wait for clear instructions.\"", correct: false, feedback: "‚ùå Passive." },
      { text: "\"Clarify the scope immediately and focus on a Minimum Viable Product (MVP).\"", correct: true, feedback: "‚úÖ Proactive and strategic. (+50 XP)" },
      { text: "\"Guess and hope for the best.\"", correct: false, feedback: "‚ùå Risky." }
    ]
  },
  {
    title: "CEO for a Day",
    question: "If you were the CEO for one day, what would you change first?",
    options: [
      { text: "\"Give everyone a raise.\"", correct: false, feedback: "‚ùå Financially unrealistic." },
      { text: "\"I would talk to frontline employees to understand the real bottlenecks.\"", correct: true, feedback: "‚úÖ Shows grounded leadership. (+50 XP)" },
      { text: "\"Fire the people I don't like.\"", correct: false, feedback: "‚ùå Tyrannical." }
    ]
  },
  {
    title: "Rule Breaker",
    question: "If you could remove one rule in your company, what would it be?",
    options: [
      { text: "\"Remove working hours.\"", correct: false, feedback: "‚ùå Could lead to chaos." },
      { text: "\"Remove unnecessary approval layers to speed up innovation.\"", correct: true, feedback: "‚úÖ Shows efficiency mindset. (+50 XP)" },
      { text: "\"Remove the dress code.\"", correct: false, feedback: "‚ùå Superficial." }
    ]
  },
  {
    title: "Not My Job",
    question: "What would you do if asked to do something outside your job description?",
    options: [
      { text: "\"Refuse. It's not my job.\"", correct: false, feedback: "‚ùå Rigid." },
      { text: "\"Do it if it helps the team, but discuss expectations if it becomes frequent.\"", correct: true, feedback: "‚úÖ Flexible but sets boundaries. (+50 XP)" },
      { text: "\"Do it and complain to everyone.\"", correct: false, feedback: "‚ùå Toxic." }
    ]
  },
  {
    title: "Quality vs Speed",
    question: "If you had to choose between quality and speed, what would you prioritize?",
    options: [
      { text: "\"Speed always. Ship it!\"", correct: false, feedback: "‚ùå Technical debt risk." },
      { text: "\"It depends. Quality for core features, speed for experiments.\"", correct: true, feedback: "‚úÖ Context-aware. (+50 XP)" },
      { text: "\"Quality always, no matter how long it takes.\"", correct: false, feedback: "‚ùå Missed market windows." }
    ]
  },
  {
    title: "Why Not You?",
    question: "Why should we NOT hire you?",
    options: [
      { text: "\"There is no reason. I'm perfect.\"", correct: false, feedback: "‚ùå Arrogant and lacks self-awareness." },
      { text: "\"If you want someone who follows orders without thinking, I'm not the one.\"", correct: true, feedback: "‚úÖ Turns a negative into a strength. (+50 XP)" },
      { text: "\"I'm sometimes lazy.\"", correct: false, feedback: "‚ùå Too honest." }
    ]
  },
  {
    title: "Sell Me This Pen",
    question: "Sell me this pen. ‚úíÔ∏è",
    options: [
      { text: "\"It's a really nice pen. Buy it.\"", correct: false, feedback: "‚ùå Weak pitch." },
      { text: "\"Do you have a pen? No? Well, supply and demand.\"", correct: true, feedback: "‚úÖ Creates a need. (+50 XP)" },
      { text: "\"It writes in blue.\"", correct: false, feedback: "‚ùå Feature-focused, not benefit-focused." }
    ]
  },
  {
    title: "Animal Spirit",
    question: "If you were an animal, what would you be and why?",
    options: [
      { text: "\"A Lion, because I dominate.\"", correct: false, feedback: "‚ùå Can be seen as aggressive." },
      { text: "\"An Eagle, because I see the big picture and act with precision.\"", correct: true, feedback: "‚úÖ Strategic thinking. (+50 XP)" },
      { text: "\"A Sloth.\"", correct: false, feedback: "‚ùå Implies laziness." }
    ]
  },
  {
    title: "Fermi Problem",
    question: "How many tennis balls can fit in a bus? üöå",
    options: [
      { text: "\"10,000.\"", correct: false, feedback: "‚ùå A random guess isn't enough." },
      { text: "\"I'd estimate the volume of the bus and the ball, then calculate packing density.\"", correct: true, feedback: "‚úÖ Shows analytical process. (+50 XP)" },
      { text: "\"I don't know.\"", correct: false, feedback: "‚ùå Giving up." }
    ]
  },
  {
    title: "Rejection Response",
    question: "What will you do if you are not selected even after performing well?",
    options: [
      { text: "\"I'll be angry.\"", correct: false, feedback: "‚ùå Emotional immaturity." },
      { text: "\"I'll respect the decision and ask for feedback to improve.\"", correct: true, feedback: "‚úÖ Professionalism. (+50 XP)" },
      { text: "\"I'll argue with the recruiter.\"", correct: false, feedback: "‚ùå Burning bridges." }
    ]
  },
  {
    title: "The Lifeboat",
    question: "You can either save one senior employee or two freshers. Whom do you choose?",
    options: [
      { text: "\"The Senior. Knowledge is power.\"", correct: false, feedback: "‚ùå Debatable, but often seen as valuing past over future." },
      { text: "\"The two freshers. Saving more lives is the ethical choice.\"", correct: true, feedback: "‚úÖ Utilitarian ethics usually win here. (+50 XP)" },
      { text: "\"I can't choose.\"", correct: false, feedback: "‚ùå Indecisive." }
    ]
  },
  {
    title: "Stolen Credit",
    question: "If your teammate takes credit for your work in front of management, how will you respond?",
    options: [
      { text: "\"Shout at them right there.\"", correct: false, feedback: "‚ùå Unprofessional." },
      { text: "\"Speak to them privately, and ensure my contributions are documented in the future.\"", correct: true, feedback: "‚úÖ Assertive but professional. (+50 XP)" },
      { text: "\"Let it go.\"", correct: false, feedback: "‚ùå Passive." }
    ]
  },
  {
    title: "The Silent Mistake",
    question: "Would you report a mistake if no one else noticed it?",
    options: [
      { text: "\"No, why look bad?\"", correct: false, feedback: "‚ùå Lack of integrity." },
      { text: "\"Yes, integrity builds trust and prevents bigger issues later.\"", correct: true, feedback: "‚úÖ Integrity is key. (+50 XP)" },
      { text: "\"Only if it's huge.\"", correct: false, feedback: "‚ùå Inconsistent." }
    ]
  },
  {
    title: "Loyalty Check",
    question: "What matters more to you: loyalty to a person or loyalty to the organization?",
    options: [
      { text: "\"Loyalty to the person.\"", correct: false, feedback: "‚ùå Can lead to cronyism." },
      { text: "\"Loyalty to principles and integrity, which usually aligns with the organization's health.\"", correct: true, feedback: "‚úÖ The most mature answer. (+50 XP)" },
      { text: "\"Loyalty to the organization no matter what.\"", correct: false, feedback: "‚ùå Can lead to blind obedience." }
    ]
  }
];

let currentHRScenarioIndex = 0;
let currentGameQuestions = [];
let hrStress = 0;
let hrReputation = 50;
let hrTimerInterval;
let hrTimeLeft = 15;

function startHRDrama(stage){
  hrStress = 20; 
  hrReputation = 50; 
  currentHRScenarioIndex = 0;
  
  // Shuffle and pick 5 random questions
  currentGameQuestions = hrQuestionPool.sort(() => 0.5 - Math.random()).slice(0, 5);
  
  // Inject Styles for HR Game
  if(!document.getElementById('hrGameStyles')) {
    const style = document.createElement('style');
    style.id = 'hrGameStyles';
    style.innerHTML = `
      .hr-avatar { font-size: 80px; transition: all 0.3s ease; animation: float 3s infinite ease-in-out; }
      .hr-stat-bar { height: 10px; border-radius: 5px; background: #334155; overflow: hidden; margin-top: 5px; }
      .hr-fill { height: 100%; transition: width 0.5s ease; }
      .hr-timer-bar { height: 4px; background: #facc15; width: 100%; transition: width 1s linear; }
      .shake { animation: shake 0.5s; }
      @keyframes shake { 0% { transform: translate(1px, 1px) rotate(0deg); } 10% { transform: translate(-1px, -2px) rotate(-1deg); } 20% { transform: translate(-3px, 0px) rotate(1deg); } 30% { transform: translate(3px, 2px) rotate(0deg); } 40% { transform: translate(1px, -1px) rotate(1deg); } 50% { transform: translate(-1px, 2px) rotate(-1deg); } 60% { transform: translate(-3px, 1px) rotate(0deg); } 70% { transform: translate(3px, 1px) rotate(-1deg); } 80% { transform: translate(-1px, -1px) rotate(1deg); } 90% { transform: translate(1px, 2px) rotate(0deg); } 100% { transform: translate(1px, -2px) rotate(-1deg); } }
    `;
    document.head.appendChild(style);
  }

  stage.innerHTML = `
    <div id="hrGameContainer" style="max-width: 600px; margin: 0 auto; text-align: center;">
      <div style="display:flex; justify-content:space-between; margin-bottom: 20px; background: #1e293b; padding: 10px; border-radius: 12px;">
        <div style="flex:1; text-align:left; padding:0 10px;">
          <div style="font-size:12px; color:#cbd5f5;">Hiring Probability</div>
          <div class="hr-stat-bar"><div id="hrRepBar" class="hr-fill" style="width: 50%; background: #4ade80;"></div></div>
        </div>
        <div style="flex:1; text-align:right; padding:0 10px;">
          <div style="font-size:12px; color:#cbd5f5;">Stress Level</div>
          <div class="hr-stat-bar"><div id="hrStressBar" class="hr-fill" style="width: 20%; background: #f87171;"></div></div>
        </div>
      </div>

      <div id="hrAvatar" class="hr-avatar">üßê</div>
      <div id="hrMoodText" style="color: #94a3b8; font-size: 14px; margin-bottom: 10px;">HR is analyzing your resume...</div>

      <div id="hrQuestionArea" style="background: #1e293b; padding: 20px; border-radius: 12px; border: 1px solid #334155; position: relative; overflow: hidden;">
        <div id="hrTimerBar" class="hr-timer-bar"></div>
        <h3 id="hrQuestionText" style="color: #22d3ee; margin-top: 15px;"></h3>
        <div id="hrOptions" style="display: flex; flex-direction: column; gap: 10px; margin-top: 20px;"></div>
      </div>
      
      <div id="hrFeedback" style="margin-top: 20px; min-height: 40px; font-weight: bold;"></div>
    </div>
  `;

  loadHRScenario(0);
}

function loadHRScenario(index) {
  currentHRScenarioIndex = index;
  
  // Check Win/Loss
  if(hrStress >= 100) { endHRGame(false, "You cracked under pressure!"); return; }
  if(hrReputation <= 0) { endHRGame(false, "The HR decided not to proceed."); return; }
  if(index >= currentGameQuestions.length) { endHRGame(true, "You're Hired!"); return; }

  const scenario = currentGameQuestions[index];
  
  // Reset UI for new question
  document.getElementById('hrAvatar').innerText = "üßê";
  document.getElementById('hrMoodText').innerText = "HR is waiting for your answer...";
  document.getElementById('hrQuestionText').innerText = scenario.question;
  document.getElementById('hrFeedback').innerHTML = "";
  
  const optionsContainer = document.getElementById('hrOptions');
  optionsContainer.innerHTML = scenario.options.map((opt, i) => 
    `<button class="game-btn" style="background:#0f172a; color:white; border:1px solid #334155; text-align:left; transition:0.2s; width:100%;" 
      onmouseover="this.style.borderColor='#22d3ee'" 
      onmouseout="this.style.borderColor='#334155'"
      onclick="hrResult(${i})">${opt.text}</button>`
  ).join('');

  // Timer Logic
  hrTimeLeft = 15;
  clearInterval(hrTimerInterval);
  const timerBar = document.getElementById('hrTimerBar');
  if(timerBar) {
    timerBar.style.width = '100%';
    timerBar.style.background = '#facc15';
    
    hrTimerInterval = setInterval(() => {
      hrTimeLeft--;
      const pct = (hrTimeLeft / 15) * 100;
      timerBar.style.width = pct + '%';
      
      if(hrTimeLeft < 5) timerBar.style.background = '#f87171';
      
      if(hrTimeLeft <= 0) {
        clearInterval(hrTimerInterval);
        hrResult(-1); // Time out
      }
    }, 1000);
  }
}

function hrResult(optIndex){
  clearInterval(hrTimerInterval);
  const scenario = currentGameQuestions[currentHRScenarioIndex];
  const feedbackEl = document.getElementById('hrFeedback');
  const avatarEl = document.getElementById('hrAvatar');
  const moodEl = document.getElementById('hrMoodText');
  
  let isCorrect = false;
  let feedbackText = "";

  if(optIndex === -1) {
    // Timeout
    hrStress += 30;
    hrReputation -= 20;
    feedbackText = "‚è∞ Time's up! You hesitated too long.";
    avatarEl.innerText = "üò§";
    moodEl.innerText = "HR is impatient.";
    const container = document.getElementById('hrGameContainer');
    if(container) {
        container.classList.add('shake');
        setTimeout(()=>container.classList.remove('shake'), 500);
    }
  } else {
    const option = scenario.options[optIndex];
    isCorrect = option.correct;
    feedbackText = option.feedback;
    
    if(isCorrect) {
      hrStress = Math.max(0, hrStress - 10);
      hrReputation = Math.min(100, hrReputation + 15);
      avatarEl.innerText = "ü§©";
      moodEl.innerText = "HR is impressed!";
      updateXP(50);
    } else {
      hrStress += 20;
      hrReputation -= 15;
      avatarEl.innerText = "üôÑ";
      moodEl.innerText = "HR is skeptical.";
      const container = document.getElementById('hrGameContainer');
      if(container) {
          container.classList.add('shake');
          setTimeout(()=>container.classList.remove('shake'), 500);
      }
    }
  }

  // Update Bars
  const repBar = document.getElementById('hrRepBar');
  const stressBar = document.getElementById('hrStressBar');
  if(repBar) repBar.style.width = hrReputation + '%';
  if(stressBar) stressBar.style.width = hrStress + '%';
  
  feedbackEl.innerHTML = `<span style="color:${isCorrect ? '#4ade80' : '#f87171'}">${feedbackText}</span>`;
  
  // Disable buttons
  const btns = document.querySelectorAll('#hrOptions button');
  btns.forEach(b => b.disabled = true);

  // Next Button
  setTimeout(() => {
    if(hrStress >= 100 || hrReputation <= 0) {
        loadHRScenario(currentHRScenarioIndex); // Will trigger game over check
    } else {
        const nextBtn = document.createElement('button');
        nextBtn.className = 'game-btn';
        nextBtn.style.background = '#22d3ee';
        nextBtn.style.color = '#0f172a';
        nextBtn.style.marginTop = '10px';
        nextBtn.innerText = 'Next Scenario ‚û°';
        nextBtn.onclick = () => loadHRScenario(currentHRScenarioIndex + 1);
        feedbackEl.appendChild(document.createElement('br'));
        feedbackEl.appendChild(nextBtn);
    }
  }, 1000);
}

function endHRGame(win, msg) {
  clearInterval(hrTimerInterval);
  const stage = document.getElementById('gameStage');
  const color = win ? '#4ade80' : '#f87171';
  const emoji = win ? 'ü§ù' : 'üö™';
  
  stage.innerHTML = `
    <div style="text-align:center; animation: popIn 0.5s ease;">
      <div style="font-size: 80px; margin-bottom: 20px;">${emoji}</div>
      <h2 style="color:${color}; margin:0;">${win ? 'YOU ARE HIRED!' : 'INTERVIEW TERMINATED'}</h2>
      <p style="font-size:18px; color:#cbd5f5; margin: 20px 0;">${msg}</p>
      
      <div style="display:flex; justify-content:center; gap:20px; margin-bottom:30px;">
        <div>
            <div style="font-size:12px; color:#94a3b8;">Final Reputation</div>
            <div style="font-size:24px; font-weight:bold; color:#4ade80;">${hrReputation}%</div>
        </div>
        <div>
            <div style="font-size:12px; color:#94a3b8;">Final Stress</div>
            <div style="font-size:24px; font-weight:bold; color:#f87171;">${hrStress}%</div>
        </div>
      </div>

      <button class="game-btn" onclick="startHRDrama(document.getElementById('gameStage'))">üîÑ Try Again</button>
      <button class="game-btn" style="background:#334155; color:white;" onclick="exitGame()">Exit Lobby</button>
    </div>
  `;
}

// Game 2: Project Pitch
let pitchScore = 0;
let pitchCriteria = { tech: false, features: false, diff: false, fluency: false };

function startProjectPitch(stage) {
  pitchScore = 0;
  pitchCriteria = { tech: false, features: false, diff: false, fluency: false };

  stage.innerHTML = `
    <div style="text-align:center; position:relative;">
      <h3>üöÄ Project Pitch Game (60s)</h3>
      <p style="color:#cbd5f5;">Pitch your project. Mention tech, features, and what makes it unique!</p>
      <div id="pitchTimer" style="font-size:48px; font-weight:bold; color:#22d3ee; margin:10px 0;">60</div>
      <div id="pitchScoreContainer" style="position:relative; margin-bottom:15px;">
        <span style="font-size:24px; font-weight:bold;">Score: <span id="pitchScore">0</span></span>
        <div id="pitchPopupContainer" style="position:absolute; top:-20px; left:0; right:0; margin:auto;"></div>
      </div>
      <div id="pitchTranscript" style="min-height:80px; background:#0f172a; border-radius:8px; padding:10px; color:#94a3b8; margin-bottom:20px; border:1px solid #334155;">
        Your live transcript will appear here...
      </div>
      <div id="pitchCriteria" style="display:flex; justify-content:center; gap:10px; margin-bottom:20px; flex-wrap:wrap;">
        <span id="crit-tech" class="crit-tag">Technologies (+20)</span>
        <span id="crit-features" class="crit-tag">Features (+20)</span>
        <span id="crit-diff" class="crit-tag">Unique Edge (+40)</span>
        <span id="crit-fluency" class="crit-tag">Fluency (+20)</span>
      </div>
      <button id="pitchStartBtn" class="game-btn" onclick="runProjectPitch()">üé§ Start Pitch</button>
    </div>
    <style>
      .crit-tag { background:#334155; color:#94a3b8; padding: 5px 12px; border-radius:15px; font-size:13px; transition: all 0.3s ease; }
      .crit-hit { background:#4ade80; color:#0f172a; font-weight:bold; transform: scale(1.1); }
      @keyframes floatUp {
        from { transform: translateY(0); opacity: 1; }
        to { transform: translateY(-40px); opacity: 0; }
      }
      .score-popup {
        position: absolute;
        left: 50%;
        transform: translateX(-50%);
        font-size: 18px;
        font-weight: bold;
        animation: floatUp 1.5s ease-out forwards;
      }
    </style>
  `;
}

function runProjectPitch() {
  const startBtn = document.getElementById('pitchStartBtn');
  startBtn.disabled = true;
  startBtn.innerText = 'üî¥ Recording...';

  let timeLeft = 60;
  const timerEl = document.getElementById('pitchTimer');
  const transcriptEl = document.getElementById('pitchTranscript');
  
  document.querySelectorAll('.crit-tag').forEach(el => el.classList.remove('crit-hit'));
  transcriptEl.innerText = 'Listening...';

  gameInterval = setInterval(() => {
    timeLeft--;
    timerEl.innerText = timeLeft;
    if (timeLeft <= 0) {
      stopProjectPitch();
    }
  }, 1000);

  if ('webkitSpeechRecognition' in window) {
    gameRecognition = new webkitSpeechRecognition();
    gameRecognition.lang = "en-US";
    gameRecognition.continuous = true;
    gameRecognition.interimResults = true;
    gameRecognition.onresult = event => {
      let fullTranscript = "";
      for (let i = event.resultIndex; i < event.results.length; ++i) {
        fullTranscript += event.results[i][0].transcript;
      }
      transcriptEl.innerText = fullTranscript;
      analyzePitch(fullTranscript);
    };
    gameRecognition.onend = () => { if (timeLeft > 0) stopProjectPitch(); };
    gameRecognition.start();
  } else {
    alert("Speech recognition not supported.");
    stopProjectPitch();
  }
}

function analyzePitch(text) {
  const lowerText = text.toLowerCase();
  const techKeywords = ['react', 'angular', 'node.js', 'python', 'django', 'java', 'sql', 'mongodb', 'aws', 'docker', 'firebase', 'javascript'];
  if (!pitchCriteria.tech && techKeywords.some(k => lowerText.includes(k))) {
    pitchCriteria.tech = true;
    updatePitchScore(20, 'Tech!', 'crit-tech');
  }
  const featureKeywords = ['feature', 'implemented', 'allows users', 'capability', 'functionality', 'built a'];
  if (!pitchCriteria.features && featureKeywords.some(k => lowerText.includes(k))) {
    pitchCriteria.features = true;
    updatePitchScore(20, 'Features!', 'crit-features');
  }
  const diffKeywords = ['unlike', 'different from', 'better than', 'unique', 'advantage over', 'more efficient'];
  if (!pitchCriteria.diff && diffKeywords.some(k => lowerText.includes(k))) {
    pitchCriteria.diff = true;
    updatePitchScore(40, 'Unique Edge!', 'crit-diff');
  }
}

function updatePitchScore(points, label, critId) {
  pitchScore += points;
  document.getElementById('pitchScore').innerText = pitchScore;
  document.getElementById(critId).classList.add('crit-hit');
  const popupContainer = document.getElementById('pitchPopupContainer');
  const popup = document.createElement('div');
  popup.className = 'score-popup';
  popup.style.color = '#4ade80';
  popup.innerText = `+${points} ${label}`;
  popupContainer.appendChild(popup);
  setTimeout(() => popup.remove(), 1500);
}

function stopProjectPitch() {
  clearInterval(gameInterval);
  if (gameRecognition) gameRecognition.stop();
  
  const startBtn = document.getElementById('pitchStartBtn');
  if(startBtn) {
    startBtn.disabled = true;
    startBtn.innerText = 'Analyzing...';
  }

  const transcript = document.getElementById('pitchTranscript').innerText;
  const wordCount = transcript.trim().split(/\s+/).length;
  if (!pitchCriteria.fluency && wordCount > 80) { // ~1.3 words/sec is decent
    pitchCriteria.fluency = true;
    updatePitchScore(20, 'Fluency!', 'crit-fluency');
  }

  setTimeout(showPitchReport, 1000);
}

function showPitchReport() {
    const stage = document.getElementById('gameStage');
    let feedbackMsg = "";
    if (pitchScore >= 80) feedbackMsg = "Excellent pitch! You hit all the key points with great fluency.";
    else if (pitchScore >= 50) feedbackMsg = "Good effort! Try to elaborate more on what makes your project unique.";
    else feedbackMsg = "A good start. Practice structuring your pitch around the tech, features, and unique advantages.";

    stage.innerHTML = `
        <div style="text-align:center; animation: popIn 0.5s ease;">
            <h3>Pitch Report</h3>
            <p style="font-size:18px; color:#cbd5f5;">Final Score: <span style="color:#4ade80; font-weight:bold;">${pitchScore} / 100</span></p>
            <div style="margin: 20px 0; line-height:1.8; color:#cbd5f5;">
                ${pitchCriteria.tech ? '‚úÖ Technologies Mentioned (+20)' : '‚ùå Technologies Missed'}<br>
                ${pitchCriteria.features ? '‚úÖ Features Explained (+20)' : '‚ùå Features Missed'}<br>
                ${pitchCriteria.diff ? '‚úÖ Unique Edge Highlighted (+40)' : '‚ùå Differentiation Missed'}<br>
                ${pitchCriteria.fluency ? '‚úÖ Good Fluency (+20)' : '‚ùå Fluency Could Be Better'}
            </div>
            <p style="color:#94a3b8;">${feedbackMsg}</p>
            <button class="game-btn" onclick="startProjectPitch(document.getElementById('gameStage'))">üîÑ Pitch Again</button>
            <button class="game-btn" style="background:#334155; color:white;" onclick="exitGame()">Exit</button>
        </div>
    `;
    updateXP(pitchScore);
}

// Game 7: Client Call Chaos

const clientScenarios = [
    {
        clientLine: "This is unacceptable! The new feature you deployed just crashed our entire system during peak hours!",
        clientMood: "üò°",
        options: [
            { text: "Acknowledge & Empathize: 'I'm so sorry to hear that. That sounds incredibly frustrating. Let's get this fixed immediately.'", effect: { patience: 15, satisfaction: 20 }, feedback: "Good start. Empathy de-escalates the situation." },
            { text: "Get Defensive: 'It was working fine in testing. Are you sure it's our fault?'", effect: { patience: -30, satisfaction: -25 }, feedback: "Never blame the client. This increases their anger." },
            { text: "Make Excuses: 'We're a bit understaffed right now, things are slipping through.'", effect: { patience: -20, satisfaction: -20 }, feedback: "Excuses sound unprofessional and erode trust." }
        ]
    },
    {
        clientLine: "I don't care about your apologies! We're losing money every minute. What are you going to DO about it, right now?!",
        clientMood: "ü§¨",
        options: [
            { text: "Offer a Plan: 'My top engineer is investigating the root cause now. I'll give you an update in 15 minutes.'", effect: { patience: 20, satisfaction: 25 }, feedback: "Providing a concrete plan shows you're in control." },
            { text: "Promise the Impossible: 'I'll have it fixed in the next 5 minutes!'", effect: { patience: -10, satisfaction: -15 }, feedback: "Don't overpromise. If you fail, you'll lose all credibility." },
            { text: "Shift Blame: 'Let me check with the server team, it's probably their issue.'", effect: { patience: -25, satisfaction: -20 }, feedback: "Passing the buck makes you look weak." }
        ]
    },
    {
        clientLine: "15 minutes? I don't have 15 minutes! I need a solution, not a status update!",
        clientMood: "üò§",
        options: [
            { text: "Reassure & Offer a Rollback: 'I understand. As a precaution, we can roll back the update to get you stable instantly. Is that okay?'", effect: { patience: 25, satisfaction: 30 }, feedback: "Offering an immediate (if temporary) solution is a powerful move." },
            { text: "Argue: 'Sir, we need time to diagnose properly. Rushing will only make it worse.'", effect: { patience: -30, satisfaction: -25 }, feedback: "While true, arguing with an angry client is a losing battle." },
            { text: "Go Silent: '...' (Say nothing)", effect: { patience: -40, satisfaction: -30 }, feedback: "Silence is the worst possible response in a crisis." }
        ]
    },
    {
        clientLine: "Fine. Roll it back. But what about the data we lost? And how do I know this won't happen again?",
        clientMood: "ü§î",
        options: [
            { text: "Take Ownership & Promise a Post-mortem: 'You're right. Once you're stable, we'll conduct a full post-mortem report on what went wrong and the steps we'll take to prevent it.'", effect: { patience: 20, satisfaction: 35 }, feedback: "This shows accountability and a long-term commitment to quality." },
            { text: "Offer a Discount: 'We can offer a 20% discount on your next bill for the trouble.'", effect: { patience: 10, satisfaction: 15 }, feedback: "A discount can help, but it doesn't solve the root trust issue." },
            { text: "Minimize the Issue: 'Data loss was minimal, and we're confident it's a one-off issue.'", effect: { patience: -20, satisfaction: -25 }, feedback: "Never minimize the client's problem. It invalidates their concerns." }
        ]
    },
    {
        clientLine: "Alright... a post-mortem report sounds appropriate. I expect it on my desk by tomorrow.",
        clientMood: "üôÇ",
        options: [
            { text: "Confirm & Conclude: 'Absolutely. You'll have it by EOD tomorrow. Thank you for your patience. We'll get this right.'", effect: { patience: 10, satisfaction: 30 }, feedback: "A strong, confident closing reinforces the solution." },
            { text: "Keep Apologizing: 'Again, I am so, so sorry for all this.'", effect: { patience: 0, satisfaction: -5 }, feedback: "You've already apologized. Now it's time for action, not more apologies." }
        ]
    }
];

let clientPatience = 50;
let clientSatisfaction = 0;
let clientScenarioIndex = 0;
let clientTimerInterval;

function startClientChaos(stage) {
    clientPatience = 50;
    clientSatisfaction = 0;
    clientScenarioIndex = 0;
    if('speechSynthesis' in window) window.speechSynthesis.cancel();

    stage.innerHTML = `
        <div id="clientGameContainer" style="max-width: 700px; margin: 0 auto; text-align: center;">
            <div style="display:flex; justify-content:space-between; margin-bottom: 20px; background: #1e293b; padding: 10px; border-radius: 12px;">
                <div style="flex:1; text-align:left; padding:0 10px;">
                    <div style="font-size:12px; color:#cbd5f5;">Client Patience</div>
                    <div class="hr-stat-bar"><div id="clientPatienceBar" class="hr-fill" style="width: 50%; background: #f87171;"></div></div>
                </div>
                <div style="flex:1; text-align:right; padding:0 10px;">
                    <div style="font-size:12px; color:#cbd5f5;">Satisfaction</div>
                    <div class="hr-stat-bar"><div id="clientSatBar" class="hr-fill" style="width: 0%; background: #4ade80;"></div></div>
                </div>
            </div>

            <div id="clientAvatar" style="font-size: 80px; transition: all 0.3s ease; animation: float 3s infinite ease-in-out;">üò†</div>
            <div id="clientMoodText" style="color: #f87171; font-size: 14px; margin-bottom: 10px; font-weight:bold;">Client is FURIOUS</div>

            <div id="clientDialogueArea" style="background: #1e293b; padding: 20px; border-radius: 12px; border: 1px solid #334155; position: relative; overflow: hidden;">
                <div id="clientTimerBar" class="hr-timer-bar" style="background:#f87171;"></div>
                <p id="clientLineText" style="color: #cbd5f5; margin-top: 15px; font-style:italic; min-height:50px;"></p>
                <div id="clientOptions" style="display: flex; flex-direction: column; gap: 10px; margin-top: 20px;"></div>
            </div>
            
            <div id="clientFeedback" style="margin-top: 20px; min-height: 40px; font-weight: bold;"></div>
        </div>
    `;
    loadClientScenario(0);
}

function loadClientScenario(index) {
    clientScenarioIndex = index;

    if (clientPatience <= 0) { endClientChaos(false, "The client hung up on you!"); return; }
    if (clientSatisfaction >= 100) { endClientChaos(true, "You saved the deal!"); return; }
    if (index >= clientScenarios.length) { endClientChaos(true, "You successfully handled the situation!"); return; }

    const scenario = clientScenarios[index];
    
    document.getElementById('clientAvatar').innerText = scenario.clientMood;
    document.getElementById('clientLineText').innerText = `"${scenario.clientLine}"`;
    document.getElementById('clientFeedback').innerHTML = "";
    
    speakClient(scenario.clientLine);

    const optionsContainer = document.getElementById('clientOptions');
    optionsContainer.innerHTML = scenario.options.map((opt, i) => 
        `<button class="game-btn" style="background:#0f172a; color:white; border:1px solid #334155; text-align:left; transition:0.2s; width:100%;" 
          onmouseover="this.style.borderColor='#22d3ee'" 
          onmouseout="this.style.borderColor='#334155'"
          onclick="clientResult(${i})">${opt.text}</button>`
    ).join('');

    // Timer
    let timeLeft = 15;
    clearInterval(clientTimerInterval);
    const timerBar = document.getElementById('clientTimerBar');
    timerBar.style.width = '100%';
    clientTimerInterval = setInterval(() => {
        timeLeft--;
        timerBar.style.width = (timeLeft / 15) * 100 + '%';
        if (timeLeft <= 0) {
            clearInterval(clientTimerInterval);
            clientResult(-1); // Timeout
        }
    }, 1000);
}

function clientResult(optIndex) {
    clearInterval(clientTimerInterval);
    const scenario = clientScenarios[clientScenarioIndex];
    const feedbackEl = document.getElementById('clientFeedback');
    
    let effect, feedbackText;

    if (optIndex === -1) { // Timeout
        effect = { patience: -25, satisfaction: -20 };
        feedbackText = "You took too long to respond! The client is getting more impatient.";
        document.getElementById('clientGameContainer').classList.add('shake');
        setTimeout(()=>document.getElementById('clientGameContainer').classList.remove('shake'), 500);
    } else {
        const option = scenario.options[optIndex];
        effect = option.effect;
        feedbackText = option.feedback;
        if(effect.patience < 0){
            document.getElementById('clientGameContainer').classList.add('shake');
            setTimeout(()=>document.getElementById('clientGameContainer').classList.remove('shake'), 500);
        }
    }

    clientPatience = Math.min(100, Math.max(0, clientPatience + effect.patience));
    clientSatisfaction = Math.min(100, Math.max(0, clientSatisfaction + effect.satisfaction));

    // Update UI
    document.getElementById('clientPatienceBar').style.width = clientPatience + '%';
    document.getElementById('clientSatBar').style.width = clientSatisfaction + '%';
    
    const moodTextEl = document.getElementById('clientMoodText');
    if(clientPatience < 25) { moodTextEl.innerText = "About to hang up..."; moodTextEl.style.color = "#ef4444"; }
    else if(clientPatience < 50) { moodTextEl.innerText = "Losing patience..."; moodTextEl.style.color = "#f87171"; }
    else if(clientSatisfaction > 75) { moodTextEl.innerText = "Client is satisfied."; moodTextEl.style.color = "#4ade80"; }
    else if(clientSatisfaction > 50) { moodTextEl.innerText = "Client is calming down."; moodTextEl.style.color = "#facc15"; }
    else { moodTextEl.innerText = "Client is still angry."; moodTextEl.style.color = "#f87171"; }

    feedbackEl.innerHTML = `<span style="color:${effect.patience > 0 ? '#4ade80' : '#f87171'}">${feedbackText}</span>`;
    
    document.querySelectorAll('#clientOptions button').forEach(b => b.disabled = true);

    setTimeout(() => {
        loadClientScenario(clientScenarioIndex + 1);
    }, 2500);
}

function endClientChaos(win, msg) {
    clearInterval(clientTimerInterval);
    if('speechSynthesis' in window) window.speechSynthesis.cancel();
    const stage = document.getElementById('gameStage');
    const color = win ? '#4ade80' : '#f87171';
    const emoji = win ? 'ü§ù' : 'üìûüí•';
    const title = win ? 'DEAL SAVED' : 'CLIENT LOST';
    updateXP(win ? 100 : 10);

    stage.innerHTML = `
        <div style="text-align:center; animation: popIn 0.5s ease;">
            <div style="font-size: 80px; margin-bottom: 20px;">${emoji}</div>
            <h2 style="color:${color}; margin:0;">${title}</h2>
            <p style="font-size:18px; color:#cbd5f5; margin: 20px 0;">${msg}</p>
            
            <div style="display:flex; justify-content:center; gap:20px; margin-bottom:30px;">
                <div>
                    <div style="font-size:12px; color:#94a3b8;">Final Patience</div>
                    <div style="font-size:24px; font-weight:bold; color:#f87171;">${clientPatience}%</div>
                </div>
                <div>
                    <div style="font-size:12px; color:#94a3b8;">Final Satisfaction</div>
                    <div style="font-size:24px; font-weight:bold; color:#4ade80;">${clientSatisfaction}%</div>
                </div>
            </div>

            <button class="game-btn" onclick="startClientChaos(document.getElementById('gameStage'))">üîÑ Try Again</button>
            <button class="game-btn" style="background:#334155; color:white;" onclick="exitGame()">Exit Lobby</button>
        </div>
    `;
}

function speakClient(text) {
    if('speechSynthesis' in window){
        const u = new SpeechSynthesisUtterance(text);
        u.lang = "en-US";
        u.pitch = 0.8;
        u.rate = 0.9;
        u.voice = speechSynthesis.getVoices().find(v => v.name.includes("David") || v.name.includes("Zira") || v.name.includes("Google US English"));
        window.speechSynthesis.speak(u);
    }
}
</script>
</body>
</html>